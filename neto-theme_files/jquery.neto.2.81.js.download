/** VERSION 2.81 **/
/** INCLUDE jquery.neto.-.js **/ /** INIT **/ (function( NETO, $, undefined ) { NETO.systemConfigs = NETO.systemConfigs || {}; if (typeof $.fn.on != 'function') { $.fn.on = function(e, selector, handler) { return $(selector).live(e, handler); } } if (typeof $.fn.off != 'function') { $.fn.off = function(e, selector, handler) { return $(selector).die(e, handler); } } }( window.NETO = window.NETO || {}, jQuery ));
/** INCLUDE jquery.neto.addressbook.js **/ /* ADDRESS BOOK */ (function($) { $.extend({ add_addressbook_entry: function() { var fn = 'addressbook'; var errors = ''; var addrid = $('#addr_id').val(); var shiptitle = $('#ship_title').val(); var firstname = $('#ship_first_name').val(); var lastname = $('#ship_last_name').val(); var company = $('#ship_company').val(); var street1 = $('#ship_street1').val(); var street2 = $('#ship_street2').val(); var zip = $('#ship_zip').val(); var city = $('#ship_city').val(); var state = $('#ship_state').val(); var country = $('#ship_country').val(); var phone = $('#ship_phone').val(); var isdefault = $('input[name="defaddr"]').is(':checked'); if ($.isEmpty(shiptitle)) { errors += 'Address Title is required<br />' }; if ($.isEmpty(firstname)) { errors += 'First Name is required<br />' }; if ($.isEmpty(lastname)) { errors += 'Last Name is required<br />' }; if ($.isEmpty(street1) && $.isEmpty(street2)) { errors += 'Street Address is required<br />' }; if ($.isEmpty(zip)) { errors += 'Post Code is required<br />' }; if ($.isEmpty(city)) { errors += 'City is required<br />' }; if ($.isEmpty(state)) { errors += 'State is required<br />' }; if ($.isEmpty(country)) { errors += 'Country is required<br />' }; if ($.isEmpty(phone)) { errors += 'Phone number is required<br />' }; if (!$.isEmpty(errors)) { errors = "<center><b>ERRORS DETECTED</b></center><br /><br />" + errors; $.nPopupBox(errors, {'duration': 5000}); } else { $.nShowActivity(); $.do_ajax( fn, { 'proc':'Add','ship_first_name':firstname,'ship_last_name':lastname, 'ship_company':company, 'ship_street1':street1, 'ship_street2': street2, 'ship_zip':zip, 'ship_state':state, 'ship_country':country, 'ship_city':city, 'ship_phone':phone, 'addid':addrid, 'ship_title':shiptitle, setdefault: isdefault }, true, { 'SUCCESS': { 'def' : { }, 'fn' : function (code, data) { if (data['addentry'] == 'y') { $('select[id^="addr_id"]').append("<option value=\""+data['addressbook_id']+"\">"+shiptitle+" ("+zip+")</option>"); $.nPopupBox("Address added successfully", {'duration': 2000}); } else if (data['addressbook_id'] == addrid) { $('select[id^="addr_id"] option[value="'+data['addressbook_id']+'"]').text(shiptitle+" ("+zip+")"); $.nPopupBox("Address Updated Successfully", {'duration': 2000}); } else if (data['addressbook_id'] && addrid == '') { $('select[id^="addr_id"] option[value="'+data['addressbook_id']+'"]').text(shiptitle+" ("+zip+")"); $.nPopupBox("Default Address Updated Successfully", {'duration': 2000}); } else { $.nPopupBox("Error", {'duration': 2000}); } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { if(param['debug']){ alert(data['response']); } } } } ); } }, del_addressbook_entry: function() { var fn = 'addressbook'; var addrid = $('#addr_id').val(); $.do_ajax( fn, {'proc':'delete','addid':addrid}, true, { 'SUCCESS': { 'def' : { }, 'fn' : function (code, data) { $('select[id^="addr_id"] :selected').remove(); $('#ship_title').val(''); $('#ship_first_name').val(''); $('#ship_last_name').val(''); $('#ship_company').val(''); $('#ship_street1').val(''); $('#ship_street2').val(''); $('#ship_zip').val(''); $('#ship_city').val(''); $('#ship_state').val(''); $('#ship_country').val(''); $('#ship_phone').val(''); $('#addr_id').val(''); $('#suburb_diship').css("display", "none"); $('#suburb_mgship').css("display", "inline"); $('#suburb_mgship').html('<i>Please enter your city and state below.<\/i>'); $('#delete_button').attr('disabled', 'disabled'); $.nPopupBox("Address removed successfully", {'duration': 2000}); } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { if(param['debug']){ alert(data['response']); } } } }); }, addressbook_select: function(param) { var fn = 'addressbook'; if(!(param instanceof Object) ) { param = {};} var defvals = { 'fns' : {} }; param = $.soap_default_data(param ,defvals); $('select[id^="addr_id"]').change(function() { var addid = $(this).val(); if (addid == 'n') { $('#ship_title').val(''); $('#ship_first_name').val(''); $('#ship_last_name').val(''); $('#ship_company').val(''); $('#ship_street1').val(''); $('#ship_street2').val(''); $('#ship_zip').val(''); $('#ship_city').val(''); $('#ship_state').val(''); $('#ship_country').val(''); $('#ship_phone').val(''); $('#suburb_diship').css("display", "none"); $('#suburb_mgship').css("display", "inline"); $('#suburb_mgship').html('<i>Please enter your city and state below.<\/i>'); $('#delete_button').attr("disabled", 'disabled'); } else { $.do_ajax( fn, {'proc':'Query','addid':addid}, true, { 'SUCCESS': { 'def' : { }, 'fn' : function (code, data) { $('#ship_first_name').val(''); $('#ship_first_name').val(data['loc']['ship_first_name']); $('#ship_last_name').val(''); $('#ship_last_name').val(data['loc']['ship_last_name']); $('#ship_company').val(''); $('#ship_company').val(data['loc']['ship_company']); $('#ship_street1').val(''); $('#ship_street1').val(data['loc']['ship_street1']); $('#ship_street2').val(''); $('#ship_street2').val(data['loc']['ship_street2']); $('#ship_zip').val(''); $('#ship_zip').val(data['loc']['ship_zip']); $('#ship_city').val(''); $('#ship_city').val(data['loc']['ship_city']); $('#ship_state').val(''); $('#ship_state').val(data['loc']['ship_state']); $('#ship_country').val(''); $('#ship_country').val(data['loc']['ship_country']); $('#ship_phone').val(''); $('#ship_phone').val(data['loc']['ship_phone']); $('#ship_title').val(''); $('#ship_title').val(data['loc']['ship_title']); $('#addr_id').val(data['loc']['id']); $('input[name="defaddr"]').prop('checked', data['loc']['is_default'] == '1'); $('#delete_button').removeAttr('disabled'); if(typeof(updloca) =='function' ) { updloca('ship'); } else if( typeof(param['fns']['onChange']) =='function' ) { param['fns']['onChange'](); } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { if(param['debug']){ alert(data['response']); } } } }); } }); } }); })(jQuery); /* END ADDRESS BOOK */
/** INCLUDE jquery.neto.addtocart.js **/ /* AJAX ADD TO CART */ var NAddToCartData = new Object(); (function($) { $.extend({ addToCartDefaults : function (nofancybox, show_parent_name) { var itemName = '##name##'; if (show_parent_name) { itemName = '##parent_name## ##name##'; } return { 'image_rel': 'itmimg', 'attributes': 'productextra', 'kitting' : 'productkitting', 'cart_id' :	'cartcontents', 'target_id': 'cartcontentsheader', 'show_parent_name' : '', 'show_notifications' : true, 'nofancybox' : false, 'notifications' : { 'duration' : 0, 'show_close' : true, 'show_overlay' : false, 'padding': 0 }, 'animate' : { 'zindex': 10000, 'resize_duration': 250, 'opacity_duration': 100 }, 'summary_rels' : { 'item_count' : 'a2c_item_count', 'product_total' : 'a2c_sub_total', 'grand_total' : 'a2c_grand_total', 'shipping_total' : 'a2c_ship_total' }, 'extranotice_ids' : { 'extra_notice' : 'a2c_notice', 'extra_notice_type' : 'a2c_notice_type', 'extra_notice_min' : 'a2c_notice_min', 'extra_notice_max' : 'a2c_notice_max' }, 'cart' : { 'header': '<div class="thumb_cart"><ul>', 'body': '<li><div class="left"><a href="##producturl##" ><img src="##image##" alt="'+itemName+'" width="50px" height="50px"></a></div>'+ '<div class="right"><a href="javascript:$.removeCartItem(\'##sku##\');" class="float_right"><img src="/assets/icons/cross.png" alt="Remove From Cart"></a><div class="title"><a href="##producturl##"><b>##qty##</b> x '+itemName+' <i>##extra##</i></a></div>'+ '<div class="price">Price: ##price##</div></div></li>', 'body_withunit': '<li><div class="left"><a href="##producturl##" ><img src="##image##" alt="'+itemName+'" width="50px" height="50px"></a></div>'+ '<div class="right"><a href="javascript:$.removeCartItem(\'##sku##\');" class="float_right"><img src="/assets/icons/cross.png" alt="Remove From Cart"></a><div class="title"><a href="##producturl##"><b>##baseqty## ##base_unit##</b> (##qty## ##unit##) '+itemName+' <i>##extra##</i></a></div>'+ '<div class="price">Price: ##price##</div></div></li>', 'footer': '</ul> <br> Total Item(s): <b>##item_count##</b><br />Sub Total: <b>##CURRENCY:product_total##</b><br/> ##IF:product_discount##Discount: <b>##CURRENCY:product_discount##</b><br/>##END IF:product_discount## <button class="viewcart btn btn-default" type="button" onclick="window.location=\'##checkouturl##\';" title="View Shopping Cart">View Cart</button> <button class="checkout btn btn-success" type="button" onclick="window.location=\'##checkouturl##&fn=payment\';" title="Checkout">Checkout</button>', 'empty': '<font class="small">Your shopping cart is empty. Add items to your cart and they will appear here.</font>', 'successremmessage': ($.isMobileView() || nofancybox? '##qty## x '+itemName+' has been removed from your shopping cart.' : '<center>##qty## x '+itemName+' has been removed from your shopping cart.</center>' ), 'successaddmessage': ($.isMobileView() || nofancybox? '<b>##qty##</b> x '+itemName+' added to cart.' : '<div class="successaddmessage"><div class="header modal-header">Item has been added to your cart</div>'+ '<div class="body modal-body"><div class="image"><img src="##thumb##" alt="'+itemName+'" width="60px" height="60px" border="0"/></div>'+ '<div class="description"><b>##qty##</b> x '+itemName+' added to cart. </div>'+ '<div class="successaddmessageclear"></div></div>'+ '<div class="footer"><div class="left"><button type="button" class="btn btn-default npopup-continue" onclick="$.nClosePopupBox()" title="Continue Shopping">Continue Shopping</button>'+ '<button type="button" class="btn btn-default npopup-view" onclick="window.location=\'##checkouturl##\';" title="View Cart">View My Cart</button></div>'+ '<div class="right"><button type="button" onclick="window.location=\'##checkouturl##&fn=payment\';" title="Checkout" class="calltoaction btn btn-success npopup-checkout">Checkout Now</button></div></div>'+ '<div class="successaddmessageclear"></div></div>' ), 'successremmessage_withunit': ($.isMobileView() || nofancybox? '##baseqty## ##base_unit## (##qty## ##unit##) '+itemName+' has been removed from your shopping cart.' : '<center>##baseqty## ##base_unit## (##qty## ##unit##) '+itemName+' has been removed from your shopping cart.</center>' ), 'successaddmessage_withunit': ($.isMobileView() || nofancybox? '<b>##baseqty## ##base_unit##</b> (##qty## ##unit##) '+itemName+' added to cart.' : '<div class="successaddmessage"><div class="header">Item has been added to your cart</div>'+ '<div class="body"><div class="image"><img src="##thumb##" alt="'+itemName+'" width="60px" height="60px" border="0"/></div>'+ '<div class="description"><b>##baseqty## ##base_unit##</b> (##qty## ##unit##) '+itemName+' added to cart.</div>'+ '<div class="successaddmessageclear"></div></div>'+ '<div class="footer"><div class="left"><button type="button" class="btn btn-default npopup-continue" onclick="$.nClosePopupBox()" title="Continue Shopping">Continue Shopping</button>'+ '<button type="button" class="btn btn-default npopup-view" onclick="window.location=\'##checkouturl##\';" title="View Cart">View My Cart</button></div>'+ '<div class="right"><button type="button" onclick="window.location=\'##checkouturl##&fn=payment\';" title="Checkout" class="calltoaction btn btn-success npopup-checkout">Checkout Now</button></div></div>'+ '<div class="successaddmessageclear"></div></div>' ), 'failmessage': '<center>FAILURE: An error has occurred while processing your cart. Please retry or contact us.</center>', 'multipleitemsmessage': ($.isMobileView() || nofancybox? 'All selected items added to cart.' : '<div class="successaddmessage"><div class="header modal-header">Items have been added to your cart</div>'+ '<div class="body modal-body"><div class="description">All selected items added to cart.<br />Use the buttons below to continue.</div>'+ '<div class="successaddmessageclear"></div></div>'+ '<div class="footer"><div class="left"><button type="button" class="btn btn-default npopup-continue" onclick="$.nClosePopupBox()" title="Continue Shopping">Continue Shopping</button>'+ '<button type="button" class="btn btn-default npopup-view" onclick="window.location=\'##checkouturl##\';" title="View Cart">View My Cart</button></div>'+ '<div class="right"><button type="button" onclick="window.location=\'##checkouturl##&fn=payment\';" title="Checkout" class="calltoaction btn btn-success npopup-checkout">Checkout Now</button></div></div>'+ '<div class="successaddmessageclear"></div></div>' ), 'chooseoptions': 'Please select a number of items to purchase or choose product options.' }, 'msg' : { 'TOO_MANY_ITEMS' : '<div class="successaddmessage"><div class="header modal-header">An error has occured</div>'+ '<div class="body modal-body"><div class="description">Your cart contains too many items.<br />Please checkout your current cart, and start a new session to add new items.<br /><br /></div>'+ '<div class="successaddmessageclear"></div></div>'+ '<div class="footer modal-footer"><div class="left">'+ '<button type="button" onclick="window.location=\'##checkouturl##\';" class="btn btn-default" title="View Cart">View My Cart</button></div>'+ '<div class="right"><button type="button" onclick="window.location=\'##checkouturl##&fn=payment\';" title="Checkout" class="calltoaction btn btn-success">Checkout Now</button></div></div>'+ '<div class="successaddmessageclear"></div></div>' }, 'fns' : {}, 'unit_alias' : {}, 'checkouturl' : '', 'withunit': false, 'debug': false, 'showparam': false }; }, addToCartInit : function (param) { var nofancybox = false; if(param instanceof Object) { if(param['nofancybox']) { nofancybox = true; } } var defvals = $.addToCartDefaults(nofancybox, param['show_parent_name']); param = $.soap_default_data(param ,defvals); if(param['showparam']) { alert($.js_var_dump(param)); } NAddToCartData['param'] = param; var fn = 'addtocart'; $.do_ajax( fn, {'proc':'ShowItem', 'showparentname':param['show_parent_name']}, false, { 'SUCCESS': { 'def' : { 'ind': 0, 'sku': '', 'brand': '', 'name': '', 'price': 0, 'qty': 0, 'image': '', 'extra':'', 'total': { 'product_total': 0, 'product_discount': 0,	'product_subtotal': 0, 'shipping_total': 0, 'shipping_discount': 0, 'shipping_cost': 0, 'grand_total': 0, 'discount_total': 0, 'shipping_method': '', 'item_count':0 }, 'msg':'' }, 'fn' : function (code, data) { $.buildCartItem(data); } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); $.nPopupBox(msg, { 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {	if(param['debug']){ alert(data['response']); } } } }); $(document).off('click',".addtocart"); $(document).on('click',".addtocart",function(){ $.addCartItem('sku'+$(this).attr('rel'), 'qty'+$(this).attr('rel')); }); $(document).off('click',".delfromcart"); $(document).on('click',".delfromcart",function(){ $.addCartItem('sku'+$(this).attr('rel'), 'qty'+$(this).attr('rel')); }); }, getAddToCartParam : function () { return NAddToCartData; }, addChildCartItem : function (skuo, qtyo) { var tmpsku = ''; var tmpqty = ''; var qty = ''; var sku =''; var skuclass = skuo.replace(/^sku/,''); var nobj = $.getAddToCartParam(); if(nobj != null) { var param = nobj['param']; var fn = 'addtocart'; var pl = $('#'+param['target_id']); var imgobj = $('[rel="'+param['image_rel']+skuclass+'"]'); var imgsrc = imgobj.attr('src'); var aniobj = $('#'+imgobj.attr('rel')+'_shadow'); if(aniobj.length <= 0) { $('body').append('<div id="'+imgobj.attr('rel')+'_shadow" style="display: none; background-image: url(\''+imgsrc+'\'); background-color: #fff; border: solid 1px darkgray; position: static; top: 0px; z-index: 10000;">&nbsp;</div>'); aniobj = $('#'+imgobj.attr('rel')+'_shadow'); } aniobj.width(imgobj.css('width')).height(imgobj.css('height')).css('top', imgobj.offset().top).css('left', imgobj.offset().left).css('opacity', 0.8).show(); aniobj.css('position', 'absolute'); var anparam = { 'width':1, 'height':1, 'top': 0, 'left': imgobj.offset().left }; if(pl.length !== 0) { anparam['width'] = pl.innerWidth(); anparam['height'] = pl.innerHeight(); anparam['top'] = pl.offset().top; anparam['left'] = pl.offset().left; } else { var tobj = $('[rel="'+param['summary_rels']['item_count']+'"]'); if(tobj.length !== 0) { anparam['top'] = tobj.offset().top; anparam['left'] = tobj.offset().left; } } if(anparam['width'] <= 0) { anparam['width']=1; } if(anparam['height'] <= 0) { anparam['height']=1; } aniobj.animate ( anparam, { duration: param['animate']['resize_duration'] } ).animate ( { opacity: 0 }, param['animate']['opacity_duration'], function() { $(this).hide(); $('input:hidden[class^='+skuclass+']').each(function(){ tmpsku = $(this).attr('id'); tmpqty = tmpsku.replace(/^sku/,'qty'); if ($('#'+tmpqty).val() > 0) { sku = $('#'+tmpsku).val(); qty = $('#'+tmpqty).val(); if(typeof qty != 'number') { qty = parseFloat(qty); if(isNaN(qty)) { qty=0; } } var tmpbsunit = $("#"+tmpsku.replace(/^sku/,"baseqty")); if(tmpbsunit instanceof Object) { if(tmpbsunit.length > 0) { var bsunit = parseFloat(tmpbsunit.val()); if(isNaN(bsunit)) { bsunit=0; } if(bsunit > 0) { bsunit = Math.round( bsunit * 1000 ) / 1000; qty = Math.ceil(qty / bsunit); } } } qty = Math.round(qty); $('#'+tmpqty).val(''); $.do_ajax( fn, {'proc':'AddItem','sku':sku,'qty':qty, 'showparentname':param['show_parent_name']}, false, { 'SUCCESS': { 'def' : { 'ind': 0, 'sku': '', 'brand': '', 'name': '', 'price': 0, 'qty': 0, 'image': '', 'extra':'', 'total': { 'product_total': 0, 'product_discount': 0,	'product_subtotal': 0, 'shipping_total': 0, 'shipping_discount': 0, 'shipping_cost': 0, 'grand_total': 0, 'discount_total': 0, 'shipping_method': '', 'item_count':0 }, 'msg':'' }, 'fn' : function (code, data) { if(data['image']=='') { data['image'] = imgsrc; } $.buildCartItem(data); } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); $.nPopupBox(msg, { 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {	if(param['debug']){ alert(data['response']); } } } }); } }); } ); } }, addCartItem : function (skuo, qtyo, fns) { var sku = ''; var qty = ''; var msgdata = new Object(); if(!(fns instanceof Object)) { fns={}; } skuo = $.escape_reserved(skuo); qtyo = $.escape_reserved(qtyo); var tmpskuo = $("#"+skuo); var tmpqtyo = $("#"+qtyo); var tmpmodel = $("#"+skuo.replace("sku","model")); var tmpthumb = $("#"+skuo.replace("sku","thumb")); if(tmpskuo instanceof Object) { sku=tmpskuo.val(); msgdata['sku'] = sku; } else { sku=skuo; } if(tmpqtyo instanceof Object) { qty=tmpqtyo.val(); msgdata['qty'] = qty;} else { qty=qtyo; } if(tmpmodel instanceof Object) { msgdata['model'] = msgdata['name'] = tmpmodel.val(); } if(tmpthumb instanceof Object) { msgdata['thumb'] = tmpthumb.val(); } var tmpbunitname = $("#"+skuo.replace("sku","baseunit")); if(tmpbunitname instanceof Object) { msgdata['base_unit'] = tmpbunitname.val(); } var tmpsunitname = $("#"+skuo.replace("sku","sellunit")); if(tmpsunitname instanceof Object) { msgdata['unit'] = tmpsunitname.val(); } if(typeof qty != 'number') { qty = parseFloat(qty); if(isNaN(qty)) { qty=1; } } var tmpbsunit = $("#"+skuo.replace("sku","baseqty")); if(tmpbsunit instanceof Object) { if(tmpbsunit.length > 0) { var bsunit = parseFloat(tmpbsunit.val()); if(isNaN(bsunit)) { bsunit=0; } if(bsunit > 0) { bsunit = Math.round( bsunit * 1000 ) / 1000; qty = Math.ceil(qty / bsunit); msgdata['baseqty'] = qty * bsunit; msgdata['baseqty'] = Math.round( msgdata['baseqty'] * 1000 ) / 1000; } } } qty = Math.round(qty); msgdata['qty'] = qty; var nobj = $.getAddToCartParam(); if(nobj != null && qty > 0 && sku != '') { var param = nobj['param']; msgdata['checkouturl'] = param['checkouturl']; if($.isFacebookView()) { msgdata['checkouturl'] = msgdata['checkouturl']+'&nview='+NETOFacebookViewName; } var fn = 'addtocart'; var attributes = {}; $('[id^="'+param['attributes']+'"]').each(function(index) { var ind = $(this).attr("id"); var rel = $(this).attr("rel"); var place = $(this).attr("placeholder"); var val = $(this).val(); ind = parseInt(ind.substr(param['attributes'].length)); if(!isNaN(ind) && rel==sku) { if (val != place) { attributes[ind] = val; } } }); var kitting = {}; var kitid = skuo.replace("sku", param['kitting']); $('[id^="'+kitid+'"]').each(function(index) { var rel = $.escape_reserved($(this).attr("ref")); if(typeof(rel) != 'string') { rel=''; } var typ = $(this).attr('type'); if(typeof(typ) != 'string') { typ=''; } typ = typ.toLowerCase(); var val = parseInt($(this).val()); if(isNaN(val)) { val=0; } if( typ == 'checkbox' || typ=='radio' ) { if(!$.isChecked($(this))) { val = 0; } } if(rel.length > 0) { kitting[rel] = val; } }); var imgobj = $('[rel="'+param['image_rel']+sku+'"]'); if (!imgobj.length) { if (param['show_notifications']) { if($.isMobileView()) { $.mobile.showPageLoadingMsg(); } else if(!param['nofancybox']) { $.nShowActivity(); } } $.do_ajax( fn, {'proc':'AddItem','sku':sku,'qty':qty, 'attr':attributes, 'kit': kitting, 'showparentname':param['show_parent_name']}, true, { 'SUCCESS': { 'def' : { 'ind': 0, 'sku': '', 'brand': '', 'name': '', 'price': 0, 'qty': 0, 'image': '', 'extra':'', 'total': { 'product_total': 0, 'product_discount': 0,	'product_subtotal': 0, 'shipping_total': 0, 'shipping_discount': 0, 'shipping_cost': 0, 'grand_total': 0, 'discount_total': 0, 'shipping_method': '', 'item_count':0 }, 'msg':'' }, 'fn' : function (code, data) { if(data['image']=='') { data['image'] = imgsrc; } if(typeof(data['lastitem'])=='object' && typeof(data['lastitem']['name']) != 'undefined') { if(typeof(msgdata['model'])=='undefined' || msgdata['model'] == '') { msgdata['model'] = msgdata['name'] = data['lastitem']['name']; } } var extramsg = $('#'+param['extranotice_ids']['extra_notice']); if(extramsg.length > 0) { var msg = extramsg.val(); var extramsgtype = $('#'+param['extranotice_ids']['extra_notice_type']).val(); var extramsgmin = $('#'+param['extranotice_ids']['extra_notice_min']).val(); var extramsgmax = $('#'+param['extranotice_ids']['extra_notice_max']).val(); msgdata['promomessage'] = ''; if (extramsgtype == 'product_total') { if (data['total']['product_total'] >= extramsgmin && data['total']['product_total'] <= extramsgmax) { msgdata['promomessage'] = msg; } } else if (extramsgtype == 'shipping_total') { if (data['total']['shipping_total'] >= extramsgmin && data['total']['shipping_total'] <= extramsgmax) { msgdata['promomessage'] = msg; } } else if (extramsgtype == 'grand_total') { if (data['total']['grand_total'] >= extramsgmin && data['total']['grand_total'] <= extramsgmax) { msgdata['promomessage'] = msg; } } } $.buildCartItem(data); if(typeof(fns['onReady']) == 'function') { fns['onReady'](data['content']); } if (!isEmpty(data['discountmessage'])) { if($.isMobileView()) { $.mobilePopupMessage(data['discountmessage']); } else if(param['nofancybox']) { } else { $.nPopupBox(data['discountmessage'], { 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } if(typeof param['fns']['onMessage'] == 'function') { param['fns']['onMessage'](data['discountmessage']);	} } else { if (param['show_notifications']) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else if(!param['nofancybox']) { $.nHideActivity(); } var notification = ''; var done = false; if( typeof(data['lastitem']) != 'undefined' && data['lastitem'] instanceof Object ) { for(var k in data['lastitem']) { msgdata[k] = data['lastitem'][k]; } } if(typeof(msgdata['price']) != 'undefined') { msgdata['sub_total']= $.formatCurrency(msgdata['price']*qty); msgdata['price']= $.formatCurrency(msgdata['price']); } if(param['withunit'] && typeof(msgdata['base_unit']) == 'string') { if(msgdata['base_unit'].length > 0) { if(typeof(param['unit_alias'][msgdata['base_unit']])== 'string') { msgdata['base_unit'] = param['unit_alias'][msgdata['base_unit']] } if(typeof(msgdata['unit']) == 'string') { if(typeof(param['unit_alias'][msgdata['unit']])== 'string') { msgdata['unit'] = param['unit_alias'][msgdata['unit']] } } notification = $.parse_ntemplate(param['cart']['successaddmessage_withunit'], msgdata); done = true; } } if(!done) { notification = $.parse_ntemplate(param['cart']['successaddmessage'], msgdata); } if($.isMobileView()) { $.mobilePopupMessage(notification); } else if(param['nofancybox']) { } else { $.nPopupBox(notification, {'duration': param['notifications']['duration'], 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } if(typeof param['fns']['onMessage'] == 'function') { param['fns']['onMessage'](notification);	} } } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else if(!param['nofancybox']) { $.nHideActivity(); } if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); $.nPopupBox(msg, { 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else if(!param['nofancybox']) { $.nHideActivity(); } if(param['debug']){ alert(data['response']); } } } }); } else { var pl = $('#'+param['target_id']); var imgsrc = imgobj.attr('src'); var attr_rel = $.escape_reserved(imgobj.attr('rel')); var aniobj = $('#'+attr_rel+'_shadow'); if(aniobj.length <= 0) { $('body').append('<div id="'+imgobj.attr('rel')+'_shadow" style="display: none; background-image: url(\''+imgsrc+'\'); background-color: #fff; border: solid 1px darkgray; position: static; top: 0px; z-index: 100000;">&nbsp;</div>'); aniobj = $('#'+attr_rel+'_shadow'); } aniobj.width(imgobj.css('width')).height(imgobj.css('height')).css('top', imgobj.offset().top).css('left', imgobj.offset().left).css('opacity', 0.5).show(); aniobj.css('position', 'absolute'); var anparam = { 'width':1, 'height':1, 'top': 0, 'left': imgobj.offset().left }; if(pl.length !== 0) { anparam['width'] = pl.innerWidth(); anparam['height'] = pl.innerHeight(); anparam['top'] = pl.offset().top; anparam['left'] = pl.offset().left; } else { var tobj = $('[rel="'+param['summary_rels']['item_count']+'"]'); if(tobj.length !== 0) { anparam['top'] = tobj.offset().top; anparam['left'] = tobj.offset().left; } } if(anparam['width'] <= 0) { anparam['width']=1; } if(anparam['height'] <= 0) { anparam['height']=1; } aniobj.animate ( anparam, { duration: param['animate']['resize_duration'] } ).animate( { opacity: 0 }, param['animate']['opacity_duration'], function() { $(this).hide(); if (param['show_notifications']) { if($.isMobileView()) { $.mobile.showPageLoadingMsg(); } else if(!param['nofancybox']) { $.nShowActivity(); } } $.do_ajax( fn, {'proc':'AddItem','sku':sku,'qty':qty, 'attr':attributes, 'kit': kitting, 'showparentname':param['show_parent_name']}, true, { 'SUCCESS': { 'def' : { 'ind': 0, 'sku': '', 'brand': '', 'name': '', 'price': 0, 'qty': 0, 'image': '', 'extra':'', 'total': { 'product_total': 0, 'product_discount': 0,	'product_subtotal': 0, 'shipping_total': 0, 'shipping_discount': 0, 'shipping_cost': 0, 'grand_total': 0, 'discount_total': 0, 'shipping_method': '', 'item_count':0 }, 'msg':'' }, 'fn' : function (code, data) { if(data['image']=='') { data['image'] = imgsrc; } if(typeof(data['lastitem'])=='object' && typeof(data['lastitem']['name']) != 'undefined') { if(typeof(msgdata['model'])=='undefined' || msgdata['model'] == '') { msgdata['model'] = msgdata['name'] = data['lastitem']['name']; } } var extramsg = $('#'+param['extranotice_ids']['extra_notice']); if(extramsg.length > 0) { var msg = extramsg.val(); var extramsgtype = $('#'+param['extranotice_ids']['extra_notice_type']).val(); var extramsgmin = $('#'+param['extranotice_ids']['extra_notice_min']).val(); var extramsgmax = $('#'+param['extranotice_ids']['extra_notice_max']).val(); msgdata['promomessage'] = ''; if (extramsgtype == 'product_total') { if (data['total']['product_total'] >= extramsgmin && data['total']['product_total'] <= extramsgmax) { msgdata['promomessage'] = msg; } } else if (extramsgtype == 'shipping_total') { if (data['total']['shipping_total'] >= extramsgmin && data['total']['shipping_total'] <= extramsgmax) { msgdata['promomessage'] = msg; } } else if (extramsgtype == 'grand_total') { if (data['total']['grand_total'] >= extramsgmin && data['total']['grand_total'] <= extramsgmax) { msgdata['promomessage'] = msg; } } } $.buildCartItem(data); if (!isEmpty(data['discountmessage'])) { if($.isMobileView()) { $.mobilePopupMessage( data['discountmessage'] ); } else if(param['nofancybox']) { } else { $.nPopupBox(data['discountmessage'], { 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } if(typeof param['fns']['onMessage'] == 'function') { param['fns']['onMessage'](data['discountmessage']);	} } else { if (param['show_notifications']) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else if(!param['nofancybox']) { $.nHideActivity(); } var notification = ''; var done = false; if( typeof(data['lastitem']) != 'undefined' && data['lastitem'] instanceof Object ) { for(var k in data['lastitem']) { msgdata[k] = data['lastitem'][k]; } } if(typeof(msgdata['price']) != 'undefined') { msgdata['sub_total']= $.formatCurrency(msgdata['price']*qty); msgdata['price']= $.formatCurrency(msgdata['price']); } if(param['withunit'] && typeof(msgdata['base_unit']) == 'string') { if(msgdata['base_unit'].length > 0) { if(typeof(param['unit_alias'][msgdata['base_unit']])== 'string') { msgdata['base_unit'] = param['unit_alias'][msgdata['base_unit']] } if(typeof(msgdata['unit']) == 'string') { if(typeof(param['unit_alias'][msgdata['unit']])== 'string') { msgdata['unit'] = param['unit_alias'][msgdata['unit']] } } notification = $.parse_ntemplate(param['cart']['successaddmessage_withunit'], msgdata); done = true; } } if(!done) { notification = $.parse_ntemplate(param['cart']['successaddmessage'], msgdata); } if($.isMobileView()) { $.mobilePopupMessage( notification ); } else if(param['nofancybox']) { } else { $.nPopupBox(notification, {'duration': param['notifications']['duration'], 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } if(typeof param['fns']['onMessage'] == 'function') { param['fns']['onMessage'](notification);	} } } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else if(!param['nofancybox']) { $.nHideActivity(); } if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); $.nPopupBox(msg, { 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else if(!param['nofancybox']) { $.nHideActivity(); } if(param['debug']){ alert(data['response']); } } } }); }); } } else { if(nobj != null) { var param = nobj['param']; if($.isMobileView()) { $.mobilePopupMessage(param['cart']['chooseoptions']); } else if(param['nofancybox']) { } else { $.nPopupBox(param['cart']['chooseoptions']); } if(typeof param['fns']['onMessage'] == 'function') { param['fns']['onMessage'](param['cart']['chooseoptions']);	} } } }, addMultipleCartItems: function(id) { var fn = 'addtocart'; var esc_id = $.escape_reserved(id); var purchaseditems = new Object(); var extras = new Object(); var kits = new Object(); var msgdata = new Object; var itemsadded = false; var nobj = $.getAddToCartParam(); var param = nobj['param']; msgdata['checkouturl'] = param['checkouturl']; if($.isFacebookView()) { msgdata['checkouturl'] = msgdata['checkouturl']+'&nview='+NETOFacebookViewName; } $('#'+esc_id+' [id^="sku"]:input').each(function() { if ($(this).attr('id')) { var ctmp = $(this).attr('id').replace("sku","chk"); var chko = $("#"+esc_id+" #"+$.escape_reserved(ctmp)); var qty = 0; if( chko.length > 0 ) { if($.isChecked(chko)) { var qtyo = $("#multiaddqty"); qty = parseFloat(qtyo.val()); } } else { var tmp = $.escape_reserved($(this).attr('id').replace("sku","qty")); var qtyo = $("#"+esc_id+" #"+tmp); qty = parseFloat(qtyo.val()); qtyo.val(''); } if(isNaN(qty)) { qty=0; } var sku = $(this).val(); if(typeof(sku) != 'string') { sku = ''; } if(qty > 0 && sku.length > 0) { var tmpbsunit = $(this).attr('id').replace("sku","baseqty"); if(tmpbsunit instanceof Object) { if(tmpbsunit.length > 0) { var bsunit = parseFloat(tmpbsunit.val()); if(isNaN(bsunit)) { bsunit=0; } if(bsunit > 0) { bsunit = Math.round( bsunit * 1000 ) / 1000; qty = Math.ceil(qty / bsunit); } } } var attributes = {}; $('[id^="'+param['attributes']+'"]').each(function(index) { var ind = $(this).attr("id"); var rel = $(this).attr("rel"); if( typeof(rel) != 'string' ) { rel=''; } var applyall = $(this).attr("apply-to-all"); applyall = ( typeof(applyall) == 'string' && applyall=='yes' ? true : false ); var place = $(this).attr("placeholder"); var val = $(this).val(); if( ind.match(/\d$/) ) { ind = parseInt(ind.substr(param['attributes'].length)); if(!isNaN(ind) && (rel.length==0 || rel==sku || applyall) ) { if (val != place) { attributes[ind] = val; } } } }); var kitting = {}; var kitid = $.escape_reserved($(this).attr('id').replace("sku", param['kitting'] )); $('[id^="'+kitid+'"]').each(function(index) { var rel = $(this).attr("ref"); if(typeof(rel) != 'string') { rel=''; } var typ = $(this).attr('type'); if(typeof(typ) != 'string') { typ=''; } typ = typ.toLowerCase(); var val = parseInt($(this).val()); if(isNaN(val)) { val=0; } if( typ == 'checkbox' || typ=='radio' ) { if(!$.isChecked($(this))) { val = 0; } } if(rel.length > 0) { kitting[rel] = val; } }); itemsadded = true; purchaseditems[sku] = Math.round(qty); extras[sku] = attributes; kits[sku] = kitting; } } }); if(itemsadded) { if (param['show_notifications']) { if($.isMobileView()) { $.mobile.showPageLoadingMsg(); } else if(!param['nofancybox']) { $.nShowActivity(); } } $.do_ajax( fn, {'proc':'AddMultiItems','items':purchaseditems, 'attr': extras, 'kit': kits, 'showparentname':param['show_parent_name']}, true, { 'SUCCESS': { 'def' : { 'ind': 0, 'sku': '', 'brand': '', 'name': '', 'price': 0, 'qty': 0, 'image': '', 'extra':'', 'total': { 'product_total': 0, 'product_discount': 0,	'product_subtotal': 0, 'shipping_total': 0, 'shipping_discount': 0, 'shipping_cost': 0, 'grand_total': 0, 'discount_total': 0, 'shipping_method': '', 'item_count':0 }, 'msg':'' }, 'fn' : function (code, data) { if (param['show_notifications']) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else if(!param['nofancybox']) { $.nHideActivity(); } var msg = $.parse_ntemplate(param['cart']['multipleitemsmessage'], msgdata); if (!isEmpty(data['discountmessage'])) { if($.isMobileView()) { $.mobilePopupMessage(data['discountmessage']); } else if(param['nofancybox']) { } else { $.nPopupBox(data['discountmessage'], { 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } if(typeof param['fns']['onMessage'] == 'function') { param['fns']['onMessage'](data['discountmessage']);	} }else{ if($.isMobileView()) { $.mobilePopupMessage(msg); } else if(param['nofancybox']) { } else { $.nPopupBox(msg, {'duration': param['notifications']['duration'], 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } } if(typeof param['fns']['onMessage'] == 'function') { param['fns']['onMessage'](msg);	} } $.buildCartItem(data); } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else if(!param['nofancybox']) { $.nHideActivity(); } if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); $.nPopupBox(msg, { 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else if(!param['nofancybox']) { $.nHideActivity(); } if(param['debug']){ } } } }); } else { $.nPopupBox(param['cart']['chooseoptions']); } }, removeCartItem: function(ind, fns) { var nobj = $.getAddToCartParam(); if(!(fns instanceof Object)) { fns={}; } if(nobj != null ) { var param = nobj['param']; var fn = 'addtocart'; $.do_ajax( fn, {'proc':'RemoveItem','sku':ind, 'showparentname':param['show_parent_name']}, true, { 'SUCCESS': { 'def' : { 'ind': 0, 'sku': '', 'brand': '', 'name': '', 'price': 0, 'qty': 0, 'image': '', 'extra':'', 'total': { 'product_total': 0, 'product_discount': 0,	'product_subtotal': 0, 'shipping_total': 0, 'shipping_discount': 0, 'shipping_cost': 0, 'grand_total': 0, 'discount_total': 0, 'shipping_method': '', 'item_count':0 }, 'msg':'' }, 'fn' : function (code, data) { $.buildCartItem(data); if(typeof(fns['onReady']) == 'function') { fns['onReady'](data); } if (param['show_notifications']) { var msgdata = data['lastitem']; var notification = ''; var done = false; if( typeof(data['lastitem']) != 'undefined' && data['lastitem'] instanceof Object ) { for(var k in data['lastitem']) { msgdata[k] = data['lastitem'][k]; } } if(typeof(msgdata['price']) != 'undefined' && typeof(qty) != 'undefined') { msgdata['sub_total']= $.formatCurrency(msgdata['price']*qty); msgdata['price']= $.formatCurrency(msgdata['price']); } if(param['withunit'] && typeof(msgdata['base_unit']) == 'string') { if(msgdata['base_unit'].length > 0) { if(typeof(param['unit_alias'][msgdata['base_unit']])== 'string') { msgdata['base_unit'] = param['unit_alias'][msgdata['base_unit']] } if(typeof(msgdata['unit']) == 'string') { if(typeof(param['unit_alias'][msgdata['unit']])== 'string') { msgdata['unit'] = param['unit_alias'][msgdata['unit']] } } notification = $.parse_ntemplate(param['cart']['successremmessage_withunit'], msgdata); done = true; } } if(!done) { notification = $.parse_ntemplate(param['cart']['successremmessage'], msgdata); } if($.isMobileView()) { $.mobilePopupMessage( notification ); } else if(param['nofancybox']) { } else { $.nPopupBox(notification, {'duration': param['notifications']['duration'], 'has-overlay': param['notifications']['show_overlay'], 'has-close-btn' : param['notifications']['show_close']}); } if(typeof param['fns']['onMessage'] == 'function') { param['fns']['onMessage'](notification);	} } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {	if(param['debug']){ alert(data['response']); } } } }); } }, buildCartItem : function (data) { var nobj = $.getAddToCartParam(); if(nobj != null ) { var param = nobj['param']; var pl = $('#'+param['cart_id']); if(typeof(data['total']['checkouturl']) != 'undefined' && param['checkouturl'] =='') { param['checkouturl'] = data['total']['checkouturl']; } if($.isFacebookView()) { data['total']['checkouturl'] = data['total']['checkouturl']+'&nview='+NETOFacebookViewName; } var html = ''; if(data['total']['item_count'] > 0) { html = $.parse_ntemplate(param['cart']['header'], data['total']); for(var ctr=0; ctr<data['cartitems'].length; ctr++) { var idata = data['cartitems'][ctr]; if(typeof(idata['price']) != 'undefined') { idata['price']= $.formatCurrency(idata['price']); } var done = false; if(param['withunit'] && typeof(idata['base_unit']) == 'string') { if(idata['base_unit'].length > 0) { if(typeof(param['unit_alias'][idata['base_unit']])== 'string') { idata['base_unit'] = param['unit_alias'][idata['base_unit']] } if(typeof(idata['unit']) == 'string') { if(typeof(param['unit_alias'][idata['unit']])== 'string') { idata['unit'] = param['unit_alias'][idata['unit']] } } html += $.parse_ntemplate(param['cart']['body_withunit'], idata); done = true; } } if(!done) { html += $.parse_ntemplate(param['cart']['body'], idata); } } html += $.parse_ntemplate(param['cart']['footer'], data['total']); } else { html = $.parse_ntemplate(param['cart']['empty'], data['total']); } pl.empty(); pl.html(html); for(var k in param['summary_rels']) { if(param['summary_rels'][k] != '') { var val = param['summary_rels'][k]; var objs = $('[rel="'+param['summary_rels'][k]+'"]'); if (k == 'product_total' || k == 'shipping_total' || k == 'grand_total') { data['total'][k] = $.formatCurrency(data['total'][k]); } if(objs) { objs.text(data['total'][k]); } } } } $(document).off('click',".delfromcart"); $(document).on('click',".delfromcart",function(){ $.removeCartItem($(this).attr('rel')); }); } }); })(jQuery); /* END AJAX ADD TO CART*/
/** INCLUDE jquery.neto.ajax_search.js **/ /* AJAX SEARCH */ var NESearchTimers=[]; (function($) { $.extend({ initSearchField : function(opts) { var defvals = { 'class' : 'ajax_search', 'pl-class' : 'nsearchinput-pl', 'extra-pl-class' : 'well', 'title-class' : 'title', 'min-length' : 2, 'load-time' : 800, 'result_header' : '<ul>', 'extact_body' : '<li><a href="##url##"><span class="thumb"><img border="0" src="##thumb##" width="25px" height="25px"/></span><span class="title">##model##</span></a></li>', 'result_body' : '<li><a href="javascript:void(0);" search-keyword="##keyword##"><span class="thumb"><img border="0" src="##thumb##" width="25px" height="25px"/></span><span class="title">##model##</span></a></li>', 'result_footer' : '</ul>', 'category_header' : '<ul>', 'category_body' : '<li><a href="##url##"><span class="thumb"><img border="0" src="##thumb##" width="25px" height="25px"/></span><span class="title">##fullname## - ##typename##</span></a></li>', 'category_footer' : '</ul>', 'search_category' : false, 'include_price' : false, 'always_exact' : false, 'debug': false, 'fns' : {}, 'showparam': false }; opts = $.soap_default_data(opts ,defvals); $('html').click(function(event) { $("."+ opts['pl-class']).hide(); }); $('.'+$.escape_reserved(opts['class'])).each(function() { var initchk = $(this).attr('nsearch-init'); if( typeof(initchk) != 'string' || initchk != 'yes'  ) { $(this).attr('nsearch-init', 'yes'); var tsid = NESearchTimers.length; NESearchTimers.push(null); $(this).attr('nsearch-id', tsid); $(this).keyup(function () { var inp = $(this); var sid = parseInt($(this).attr('nsearch-id')); if(!isNaN(sid)) { var rspl = $(this).prevAll('.'+$.escape_reserved(opts['pl-class'])+'[nsearch-id="'+sid+'"]:last'); if(rspl.length <= 0) { rspl = $('<div class="'+opts['pl-class']+' ' + opts['extra-pl-class'] + '" nsearch-id="'+tsid+'"></div>').hide(); rspl.css("margin-top",($(this).height() + 10) + "px"); $(this).before(rspl); } if(NESearchTimers[sid] !== null) { clearTimeout(NESearchTimers[sid]) } var fn = 'ajax_search'; var searchkw = $.trim($(this).val()); var param = { 'keyword': searchkw, 'category':(opts['search_category']?'y':'n'), 'price': (opts['include_price']?'y':'n') }; if(searchkw.length > opts['min-length']){ if(inp.prev('img.search_loading_icon:last').length == 0){ inp.before('<img class="search_loading_icon" src="/assets/loading.gif"/>'); } else{ inp.prev('img.search_loading_icon:last').show(); } NESearchTimers[sid] = setTimeout(function() { $.do_ajax( fn, param, true, { 'SUCCESS': { 'def' : { 'results': [], 'category':[] }, 'fn' : function (code, data) { if(data['results'].length == 0 && data['category'].length==0) { inp.prev('img.search_loading_icon:last').hide(); rspl.hide(); } else { var html = ''; if(data['results'].length > 0) { html += $.parse_ntemplate(opts['result_header']); var onlyone = (data['results'].length==1); for(var ctr=0; ctr<data['results'].length; ctr++) { var idata = data['results'][ctr]; if(onlyone || opts['always_exact']) { idata['keyword'] = idata['sku']; html += $.parse_ntemplate(opts['extact_body'], idata); } else { idata['keyword'] = idata['model'].replace(/&quot;/gi,''); html += $.parse_ntemplate(opts['result_body'], idata); } } html += $.parse_ntemplate(opts['result_footer']); } if(data['category'].length > 0) { html += $.parse_ntemplate(opts['category_header']); for(var ctr=0; ctr<data['category'].length; ctr++) { var idata = data['category'][ctr]; html += $.parse_ntemplate(opts['category_body'], idata); } html += $.parse_ntemplate(opts['category_footer']); } rspl.html(html); var lnkobj = rspl.find('A[search-keyword]'); lnkobj.each(function () { var titobj = $(this).find('.'+$.escape_reserved(opts['title-class'])); var hgtxt = titobj.html(); var kwarr = searchkw.split(/\s+/); for(var i=0; i<kwarr.length; i++) { kwarr[i].replace(/[<>]+/, ''); if(kwarr[i].length > 1) { hgtxt = hgtxt.replace(new RegExp('('+$.escape_reserved(kwarr[i])+')', 'gi'), '<b>$1</b>'); } } titobj.html(hgtxt); $(this).click(function() { inp.val($(this).attr('search-keyword')); rspl.hide(); $(this).closest('FORM').submit(); }); }); inp.prev('img.search_loading_icon:last').hide(); rspl.show(); } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { inp.prev('img.search_loading_icon:last').hide(); rspl.hide(); } }, 'ERROR': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { inp.prev('img.search_loading_icon:last').hide(); rspl.hide(); } } } ); }, opts['load-time']); } } }); } }); } }); }) (jQuery); /* END AJAX SEARCH */
/** INCLUDE jquery.neto.ajax_template.js **/ /* LOAD TEMPLATE */ (function($) { $.extend({ load_ajax_template: function(id, input, fns) { function Selector_Cache() { var collection = {}; function get_from_cache( selector ) { if ( undefined === collection[ selector ] ) { collection[ selector ] = $( selector ); } return collection[ selector ]; } return { get: get_from_cache }; } var $$ = new Selector_Cache(); var fn = 'ajax_template'; var prefix = '_jstl_'; var ids = id.split(","); $.each(ids, function(ind, val) { val = prefix + val; var esc_id = $.escape_reserved(val); if(!(input instanceof Object)) { input={}; } var haschild = false; var chtmpls = {}; if ( input['child_templates'] instanceof Array ) { var charr = input['child_templates']; for ( var i = 0; i < charr.length; i++ ) { if ( charr[i] == '' ) { continue; } var cid = prefix + charr[i]; var esc_cid = $.escape_reserved(cid); $$.get('#'+esc_cid+' [id^="'+esc_cid+'_k"]:input').each( function(){ var $this = $(this); if ( $this.val() != 'template' ) { return; } var vid = $this.attr('id').replace(cid+'_k', ''); var vobj = $$.get('#'+esc_cid+' [id^="'+esc_cid+'_v'+vid+'"]:input'); chtmpls[vobj.val()] = charr[i]; haschild = true; }); } } if (input['showloading']) { $.show_div_loading(val); } var param = { 'proc': 'load', 'docid': val }; var fields = {}; $$.get('#'+esc_id+' [id^="'+esc_id+'_k"]:input').each( function(){ var $this = $(this); var vid = $this.attr('id').replace(val+'_k', ''); var key = $this.val(); if ( key == '' ) { return; } var vobj = $$.get('#'+esc_id+' [id^="'+esc_id+'_v'+vid+'"]:input'); var val2 = vobj.val(); if ( typeof val2 != 'undefined' ) { if ( key == 'type' || key =='template' ) { param[key] = val2; } else { fields[key] = val2; } } }); if(input instanceof Object) { for(var k in input) { if(k =='child_templates') { } else if( k =='loaddata' || k =='procdata') { param[k]=input[k]; } else if(k != 'noloading') { if(input[k] instanceof Array || input[k] instanceof Object) { fields[k] = input[k]; } else { var tof = typeof input[k]; if(tof == 'number' || tof == 'string') { fields[k] = input[k]; } else if(tof == 'boolean') { fields[k] = (input[k]? 'y': 'n'); } } } } } if(!(fns instanceof Object)) { fns={}; } param['fields'] = fields; if(haschild) { param['child_templates'] = chtmpls; } if(typeof(fns['onStart']) == 'function') { fns['onStart'](); } $.do_ajax( fn, param, true, { 'SUCCESS': { 'def' : { 'content':'', 'template':'', 'child_contents':{} }, 'fn' : function (code, data) { var hasfn = false; if(typeof(fns['onReady']) == 'function') { fns['onReady'](data['content']); hasfn = true; } if (data['template'] != '') { if(!hasfn) { var tmplobj = $$.get("#"+esc_id+"_r"); tmplobj.html(data['content']); if($.isMobileView()) { tmplobj.trigger('create'); } for(var cid in chtmpls) { if(data['child_contents'][cid]) { var pcid = prefix+chtmpls[cid]; var esc_cid = $.escape_reserved(pcid); var ctmplobj = $$.get("#"+esc_cid+"_r"); ctmplobj.html(data['child_contents'][cid]); if($.isMobileView()) { ctmplobj.trigger('create'); } } } } } if(typeof(fns['onLoad']) == 'function') { fns['onLoad'](data['content']); } $.remove_div_loading(val); } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { var msg = ''; if(data['msg']) { msg = $.parse_ntemplate(data['msg']); } if(typeof(fns['onFail']) == 'function') { fns['onFail'](msg); } $.remove_div_loading(val); } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { if(typeof(fns['onError']) == 'function') { fns['onError'](data['response']); } } } } ); }); } }); }) (jQuery); /* END LOAD TEMPLATE */
/** INCLUDE jquery.neto.compat_list.js **/ /* COMPATIBILITY LIST */ var NCompatListData = new Object; (function($) { $.extend({ compatListInit : function (param) { var defvals = { 'selprepend': 'clist_', 'debug': false, 'showparam': false, 'searchdiv': 'clist_search', 'searchqs': 'clist_qs', 'sizeparam': 'clist_size', 'displayparam': 'clist_hidden', 'hide_emptyparam': 'clist_hide_empty', 'sel': { 'header': '<select name="clist_##compat_id##_##level##" id="clist_##compat_id##_##level##" class="compatibility_list" rel="##compatcat_label##"><option value="">##compatcat_label##</option>', 'body': '<option value="##compatcat_id##">##compatcat_name##</option>', 'footer': '</select>', 'loading_notification': '<span class="loading_span"><img src="/assets/loading.gif" /></span>' }, 'fns' : {} }; param = $.soap_default_data(param ,defvals); if(param['showparam']) alert($.js_var_dump(param)); NCompatListData['param'] = param; }, getCompatListParam : function () { return NCompatListData; }, setCompatMatch : function(l, s) { var fn = 'compatibilitylist'; var nobj = $.getCompatListParam(); if(nobj != null ) { var param = nobj['param']; var compatlist = new Object; if (s) { $("."+s+" input:checked").each(function() { if ($(this).attr('id').match(/^compatselect/)) { var tmp = $(this).attr('id').replace("compatselect",""); if (tmp != '') { compatlist[tmp] = 1; } } }); $.do_ajax( fn, {'proc': 'setCompatMatch' , 'list': l, 'compatlist':compatlist}, true, { 'SUCCESS': { 'def' : {}, 'fn' : function (code, data) { $('.loading_span').remove(); $('.compatcat_desc').html(data['description']); $('#addvehicle').hide('slow'); if(typeof(param['fns']['setCompatMatch']) == 'function') { param['fns']['setCompatMatch'](); } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if(data['msg']) { var msg = $.parse_ntemplate(data['msg']); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { } } }); } } }, buildCompatList : function (s, u) { var fn = 'compatibilitylist'; var nobj = $.getCompatListParam(); if(nobj != null ) { var param = nobj['param']; var a = s.val(); var b = s.parent("div"); var e = $('#'+param['searchdiv']).val(); var f = $('#'+param['sizeparam']).val(); var m = $('#'+param['displayparam']).val(); var n = $.toText($('#'+param['hide_emptyparam']).val()); var qs = $('#'+param['searchqs']).val(); b.append(param['sel']['loading_notification']); if (!f) f = 0; if (!u) u = 0; if (!m) m = 0; if (!qs) qs = ''; if (a) { $.do_ajax( fn, {'proc': 'getSubList' , 'cl': a, 'cls': e, 'ssize': f, 'hidden': m, 'hide_empty': n, qs:qs}, true, { 'SUCCESS': { 'def' : {}, 'fn' : function (code, data) { if (data['compatlist'] && data['compatlist'].length > 0) { $('.loading_span').remove(); html = $.parse_ntemplate(param['sel']['header'], data); var ctr = data['compatlist']; for (var i=0; i<ctr.length; i++) { html += $.parse_ntemplate(param['sel']['body'], ctr[i]); } html += param['sel']['footer']; if (f > 1) { $('select[id^="'+param['selprepend']+data['compat_id']+'_'+data['level']+'"]').replaceWith(html); $('select[id^="'+param['selprepend']+data['compat_id']+'"]').each(function() { var repl = param['selprepend']+data['compat_id']+'_'; var c = $(this).attr('id').replace(repl, ""); if (c > data['level']) { var t = $("option:eq(0)", this).text(); $(this).empty().append('<option value="">'+t+'</option>'); if(m>0 && c==m) { $(this).hide(); } } if (c==data['hidelevel']) { $(this).hide(); $(this)[0].selectedIndex = 1; $.buildCompatList($(this), 1); } }); } else { $('select[id^="'+param['selprepend']+data['compat_id']+'"]').each(function() { var repl = param['selprepend']+data['compat_id']+'_'; var c = $(this).attr('id').replace(repl, ""); if (c >= data['level']) $(this).remove(); }); b.append(html); } $(".compatibility_list").unbind("change"); $(".compatibility_list").change(function() { $.buildCompatList($(this), 0); }); if(typeof(param['fns']['onCompatList']) == 'function') { param['fns']['onCompatList'](data); } if (e == 'button') { var rtnval = true; if(typeof(param['fns']['onCompatSelected']) == 'function') { rtnval = param['fns']['onCompatSelected'](a, data); if( typeof(rtnval) === 'undefined' ) { rtnval= true; } } if( rtnval ) { $('.compat-btn').click(function() { document.location.href = data['url']; }); } } } else if (data['description']) { $('.loading_span').remove(); $('.compatcat_desc').html(data['description']); $('.newcompatitems').append('<input type="checkbox" id="compatselect'+data['compatcat_id']+'" checked />'+data['description']+'<br />'); $('#addvehicle').hide('slow'); document.location.reload(); } else if (data['url']) { $('.loading_span').remove(); var rtnval=true; if(typeof(param['fns']['onCompatSelected']) == 'function') { rtnval = param['fns']['onCompatSelected'](a, data); if( typeof(rtnval) === 'undefined' ) { rtnval= true; } } if( rtnval ) { if (e == 'button') { $('.compat-btn').click(function() { document.location.href = data['url']; }); } else { document.location.href = data['url']; } } } else { } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if(data['msg']) { var msg = $.parse_ntemplate(data['msg']); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { } } }); } else { var g = s.attr('id').replace(param['selprepend'], ""); var h = g.replace(/\d$/, ""); var d = s.attr('id').replace(param['selprepend']+h, ""); $('select[id^="'+param['selprepend']+'"]').each(function() { h = g.replace(/\d$/, ""); var c = $(this).attr('id').replace(param['selprepend']+h, ""); if (c > d) { if (f == 0) { $(this).remove(); }	else { $('.loading_span').remove(); if ($(this).attr('rel') != '') { $(this).empty().append('<option value="">'+$(this).attr('rel')+'</option>'); } else { $(this).empty().append('<option value="">Select Option Above</option>'); } if (m > 0 && c == m) { $(this).hide(); } } } }); } } } }); })(jQuery); /* END COMPATIBILITY_LIST */
/** INCLUDE jquery.neto.endless_scroll.js **/ /* ENDLESS SCROLL FUNCTIONS */ $.endlessScrollData = {}; (function($) { $.extend({ endlessScroll_Init: function(param) { var defvals = { base_url: '/', current_page: 1, bottom_offset: 100, total_pages_class: 'endless-total-pages', page_items_class: 'endless-showing', total_items_class: 'endless-total', pagination_class: 'pagination', pagination_result_class: 'sort_container', addtodiv_class: 'add_endless', addeddiv_class: 'endless', templatehead: 'endless', templatefoot: 'endless', templatebody: 'category-endless', page: { replace_pagination_result: 'Showing ##showing## of ##total##', loading: 'Loading page ##pgnum##...' } }; $.endlessScrollData = param = $.soap_default_data(param, defvals); $.endlessScrollData['total_pages'] = parseInt($('.'+$.endlessScrollData['total_pages_class']).text()); $.endlessScrollData['total_showing'] = parseInt($('.'+$.endlessScrollData['page_items_class']).text()); $.endlessScrollData['total_items'] = parseInt($('.'+$.endlessScrollData['total_items_class']).text()); $('.'+$.endlessScrollData['pagination_class']).hide(); $.endlessScroll_updatePaging(); $(window).scroll(function() { if($(window).scrollTop() >= $(document).height() - $(window).height() - $.endlessScrollData['bottom_offset']) { $.endlessScroll_loadPage(parseInt($.endlessScrollData.current_page)+1); } }); }, endlessScroll_loadPage: function(pgnum) { var add_class = $.endlessScrollData['addeddiv_class']+'-page'+pgnum; if (pgnum <= $.endlessScrollData['total_pages'] && !$('.'+$.endlessScrollData['addtodiv_class']+' .'+add_class).length) { var html = $('<div></div>').addClass(add_class).html($.parse_ntemplate($.endlessScrollData['page']['loading'], {pgnum:pgnum})); $('.'+$.endlessScrollData['addtodiv_class']).append(html); var url = $.endlessScrollData['base_url'] + ($.endlessScrollData['base_url'].match(/\?/) ? '&' : '?') + 'pgnum=' + pgnum + '&templatehead='+$.endlessScrollData['templatehead'] + '&templatefoot='+$.endlessScrollData['templatefoot'] + '&templatebody='+$.endlessScrollData['templatebody']; $.get(url, function(data){ var html = $(data); if (!html.hasClass($.endlessScrollData['addeddiv_class'])) { html = html.find('.'+$.endlessScrollData['addeddiv_class'])} html.addClass(add_class); $('.'+$.endlessScrollData['addtodiv_class']+' .'+add_class).remove(); $('.'+$.endlessScrollData['addtodiv_class']).append(html); $.endlessScrollData['current_page'] = pgnum; $.endlessScrollData['total_showing'] = parseInt(html.find('.'+$.endlessScrollData['page_items_class']).text()) + $.endlessScrollData['total_showing']; $.endlessScroll_updatePaging(); }); } }, endlessScroll_updatePaging: function () { $('.'+$.endlessScrollData['pagination_result_class']).html($.parse_ntemplate($.endlessScrollData['page']['replace_pagination_result'], { showing:$.endlessScrollData['total_showing'], total:$.endlessScrollData['total_items'] })); } }); }) (jQuery); /* END ENDLESS SCROLL FUNCTIONS */
/** INCLUDE jquery.neto.main.js **/ /** VERSION 1.74 **/ /* UTIL FUNCTIONS */ var NETOCurrencySymbol = '$'; var NETOMobileView = false; var NETOFacebookView = false; var NETOFacebookViewName = 'facebook'; var NETOFacebookPurpose = false; var NETOFacebookPurposeName = 'facebook'; (function($) { $.extend({ isMobileView : function() { return NETOMobileView; }, isFacebookView : function() { return NETOFacebookView; }, isFacebookPurpose : function() { return NETOFacebookPurpose; }, addFacebookNView : function() { $("a").each( function() { var url = $(this).attr('href'); if(typeof url == 'string') { var tget = $(this).attr('target'); if(!tget || tget == '') { if(!url.match(/^#/) && !url.match(/nview=/) && !url.match(/javascript:/)) { if(url.match(/\?/)) { url = url + '&nview='+NETOFacebookViewName; } else { url = url + '?nview='+NETOFacebookViewName; } $(this).attr('href', url); } } } }); $("form").each( function() { var hasnview = false; $(':input', this).each( function() { if(!hasnview) { var name = $(this).attr('name'); if(typeof name == 'string' && name == 'nview') { hasnview = true; } } }); if(!hasnview) { $('<input type="hidden" name="nview" value="'+NETOFacebookViewName+'">').appendTo(this); } }); NETOFacebookView = true; }, addFacebookNPurpose : function() { $.addNPurpose(NETOFacebookPurposeName); NETOFacebookPurpose = true; }, addNPurpose : function(npur) { $("a").each( function() { var url = $(this).attr('href'); if(typeof url == 'string') { var tget = $(this).attr('target'); if(!tget || tget == '') { if(!url.match(/^#/) && !url.match(/npurpose=/) && !url.match(/javascript:/)) { if(url.match(/\?/)) { url = url + '&npurpose='+npur; } else { url = url + '?npurpose='+npur; } $(this).attr('href', url); } } } }); $("form").each( function() { var hasnpurpose = false; $(':input', this).each( function() { if(!hasnpurpose) { var name = $(this).attr('name'); if(typeof name == 'string' && name == 'npurpose') { hasnpurpose = true; } } }); if(!hasnpurpose) { $('<input type="hidden" name="npurpose" value="'+npur+'">').appendTo(this); } }); }, isJQVersion : function(cmp, vertxt) { var reg = /[^\d]+/g; var vernum = ''; var txtnum = ''; var ver = $().jquery; var verarr = ver.split('.'); for(var i=0; i<verarr.length; i++) { verarr[i].replace(reg, ''); var num = parseInt(verarr[i]); if(isNaN(num)) { num=0; } if(i==0) { vernum = num+'.'; } else { vernum += (num<10?'0':'')+num; } } var txtarr = vertxt.split('.'); for(var i=0; i<txtarr.length; i++) { txtarr[i].replace(reg, ''); var num = parseInt(txtarr[i]); if(isNaN(num)) { num=0; } if(i==0) { txtnum = num+'.'; } else { txtnum += (num<10?'0':'')+num; } } var cver = parseFloat(vernum); var chk = parseFloat(txtnum); switch (cmp) { case '>' : return cver > chk; case '<' : return cver < chk; case '>=' : return cver >= chk; case '<=' : return cver <= chk; } return cver == chk; }, setCurrencySymbol : function (symb) { NETOCurrencySymbol = symb; }, formatNumber : function (num, param) { param = $.soap_default_data(param, {'pf':'','dp':0,'sp':','}); if(param['dp'] <= 0) param['dp'] = 0; var si = param['pf']; if(num <0) { num =0-num; si = '-'+si; } num = parseFloat(num).toFixed(param['dp']); var tmp = num.split('.'); var intgr = tmp[0]; var dec = tmp[1]; if (dec) dec='.'+dec; var txt=''; var ctr = 0; for(var i=intgr.length-1; i>=0; i--) { ctr++; txt = (ctr % 3 ==0 && i>0? param['sp'] :'')+intgr.charAt(i)+''+txt; } return si+txt+dec; }, formatCurrency : function (num) { return $.formatNumber(num, {'pf':NETOCurrencySymbol,'dp':2,'sp':','} ); }, htmlEncode : function(value) { return $('<div/>').text(value).html(); }, htmlDecode : function(value) { return $('<div/>').html(value).text(); }, create_netosd_data : function (data, sp) { if(!sp) { sp = '|'; } return 'NSD1;'+$.create_netosd_data_rc(data, {}, sp); }, create_netosd_data_rc : function (data, vids, sp) { var rtn = ''; if(data instanceof Array) { rtn = '@'; var ctr = data.length; rtn += ''+ctr+sp; for(var i=0; i<ctr; i++) { rtn += ''+$.create_netosd_data_rc(data[i], vids, sp); } } else if(data instanceof Object) { rtn = '#'; var ctr = 0; for(var k in data) { ctr++; } rtn += ''+ctr+sp; for(var k in data) { rtn += ''+$.create_netosd_data_rc(k, vids, sp)+ $.create_netosd_data_rc(data[k], vids, sp); } } else { rtn = '$'; var tmp = escape(data); rtn += tmp.length + sp + tmp; } return rtn; }, parse_netosd_data : function (data, sp) { if(!sp) { sp = '|'; } var txt = data.substr(0,5); data = data.substr(5); if(txt == 'NSD1;') { var tmp = $.parse_netosd_data_rc(data, [], sp); return tmp[1]; } return null; }, parse_netosd_data_rc : function (data, vds, sp) { if(!sp) { sp = '|'; } var typ = '$'; var len = ''; var kvdata; var cur = 0; typ = data.substr(cur,1); if(typ=='#' || typ=='@' || typ=='&' || typ=='$') { var done = false; while(!done && cur<data.length) { cur++; var chr = data.substr(cur,1); if(chr== '|') { done = true; } else { len += chr; } } len = parseInt(len); if(!isNaN(len) && len >=0) { data = data.substr(cur+1); if(typ == '@' || typ == '#') { if(typ == '@') { kvdata = []; } else { kvdata = {}; } vds.push(kvdata); if(typ == '@') { for(var i=0; i<len; i++) { var tmp = $.parse_netosd_data_rc(data, vds, sp); data = tmp[0]; kvdata.push(tmp[1]); } } else { for(var i=0; i<len; i++) { var tmpk = $.parse_netosd_data_rc(data, vds, sp); data = tmpk[0]; var tmp = $.parse_netosd_data_rc(data, vds, sp); data= tmp[0]; kvdata[tmpk[1]]=tmp[1]; } } return [data, kvdata]; } else if(typ == '&') { if(len-1 < vds.length) { return [data, vds[len-1]]; } return (data, null); } else if(typ == '$') { var txt = unescape(data.substr(0,len)); txt = txt.replace(/%u{([0-9A-Za-z]+)}/g, function($1, $2){ return String.fromCharCode(parseInt('0x'+$2)); } ); data = data.substr(len); return [data, txt]; } } } return [data, kvdata]; }, js_var_dump : function (data, html, ind, vds) { if(!vds) { vds=[]; } if(!ind) { ind=0;} var br = (html? '<br>' : '\n'); var tg = (html? '&nbsp;&nbsp;' : '\t'); var rtn = ''; if(data instanceof Array) { var found = -1; for(var i=0; i<vds.length && found<0; i++) { if(vds[i] == data) { found=i; } } if(found < 0) { vds.push(data); rtn += '['+br; for(var i=0; i<data.length; i++) { for(var x=-1; x<ind; x++) { rtn+=tg; } rtn += $.js_var_dump(data[i], html, ind+1, vds)+br; } for(var x=0; x<ind; x++) { rtn+=tg; } rtn += ']'; } else { rtn += '[Array '+(found+1)+']'; } } else if(data instanceof Object) { var found = -1; for(var i=0; i<vds.length && found<0; i++) { if(vds[i] == data) { found=i; } } if(found < 0) { vds.push(data); rtn += '{'+br; for(var k in data) { for(var x=-1; x<ind; x++) { rtn+=tg; } rtn += $.js_var_dump(k, html, ind+1, vds)+': '; rtn += $.js_var_dump(data[k], html, ind+2, vds)+br; } for(var x=0; x<ind; x++) { rtn+=tg; } rtn += '}'; } else { rtn += '{Object '+(found+1)+'}'; } } else { if(typeof data == 'string') { var tmp = data.replace('\\','\\\\'); tmp = tmp.replace('"','\\"'); if(html) { tmp = tmp.replace('<','&lt;').replace('>','&gt;'); tmp = tmp.replace('&','&amp;'); } rtn += '"'+data+'"'; } else if(typeof data == 'boolean') { rtn += (data? 'true':'false'); } else if(typeof data == 'undefined') { rtn += 'undefined'; } else { rtn += data; } } return rtn; }, get_ajax_data : function (data) { var chktxt = '^NETO^'; var spchar = '^'; var code = 'ERROR'; var kvdata = {'response': data}; var pos = data.indexOf(chktxt); if(pos >= 0) { data = data.substr(pos+chktxt.length); pos = data.indexOf('^'); if(pos >= 0) { code = data.substr(0, pos); data = data.substr(pos+spchar.length); kvdata = $.parse_netosd_data(data); if(kvdata instanceof Object) { } else { kvdata = {}; } } } return [code, kvdata]; }, do_ajax : function (module, qs, syn, fns) { if(!(qs instanceof Object)) { qs = {}; } var qsctr = 0; var qstxt = ''; for(var k in qs) { if(qs[k] instanceof Array) { for(var i=0; i<qs[k].length; i++) { qstxt += (qsctr?'&':'')+escape(k)+'='+escape(qs[k][i]); } } else if(qs[k] instanceof Object) { qstxt += (qsctr?'&':'')+escape(k)+'='+escape($.create_netosd_data(qs[k])); } else { qstxt += (qsctr?'&':'')+escape(k)+'='+escape(qs[k]); } qsctr++; } $.ajax({ type: "POST", url: "/ajax/"+module, data: qstxt, async: syn, success: function(response) { var rdata = $.get_ajax_data(response); var code = rdata[0].toUpperCase(); var rdata = rdata[1]; if(fns[code] instanceof Object) { if(fns[code]['debug']) { alert(response); } if(typeof fns[code]['fn'] == 'function') { if(fns[code]['def'] instanceof Object) { rdata = $.soap_default_data(rdata, fns[code]['def']); } if(fns[code]['debug']) { alert($.js_var_dump(rdata)); } fns[code]['fn'](code, rdata); } } } }); }, soap_input_opt : function(rdata, def , vds) { if(!rdata && !(rdata instanceof Object)) { rdata = {};} return $.soap_default_data(rdata, def , vds); }, soap_default_data : function (rdata, def , vds) { if(!vds) { vds = []; } if(rdata instanceof Object) { if(def instanceof Object) { for(var k in def) { if(typeof rdata[k] == 'undefined') { rdata[k] = def[k]; } else if( def[k] instanceof Array) { if(!(rdata[k] instanceof Array)) { rdata[k] = def[k]; } } else if( def[k] instanceof Object) { if(!(rdata[k] instanceof Object)) { rdata[k] = def[k]; } else { var found = false; for(var i=0; i<vds.length && !found; i++) { if(vds[i] == def[k]) { found=true; } } if(!found) { vds.push(def[k]); rdata[k] = $.soap_default_data( rdata[k],def[k], vds); } } } else { var tof = typeof def[k]; var rof = typeof rdata[k]; if(rof != tof) { switch (tof) { case 'boolean': if(rof == 'string') { rdata[k] = $.isTrue(rdata[k]); } else if(rof == 'number') { rdata[k] = (rdata[k] >0); } else { rdata[k] = def[k]; } break; case 'number': if(rof == 'string') { var pos = rdata[k].indexOf('.'); if(pos>=0) { rdata[k] = $.toFloat(rdata[k], def[k]); } else { rdata[k] = $.toInt(rdata[k], def[k]); } } else if(rof == 'boolean') { rdata[k] = (rdata[k]? 1 : 0); } else { rdata[k] = def[k]; } break; case 'string': rdata[k] = ''+rdata[k]; break; default: rdata[k] = def[k]; break; } } } } } } else { rdata = {}; } return rdata; }, preload_images : function (images) { /* preload images into the DOM */ for(var i=0; i<images.length; i++) { if(images[i] != '') { $('<img/>')[0].src = images[i]; } } }, show_tooltip : function (obj, txt, setting, ubary) { var tmp = obj.attr("title"); obj.attr("title", txt); var unbind = {}; if(ubary instanceof Array) { for(var i=0; i<ubary.length; i++) { unbind[ubary[i]] = true; } } var oldevt = obj.data("events"); var oevtctr = {}; if(oldevt) { for(var k in oldevt) { if(unbind[k]) { oevtctr[k] = {}; for(var i=0; i<oldevt[k].length; i++) { oevtctr[k][oldevt[k][i]['guid']] = true; } } } } var tipo = obj.tooltip( setting ); var newevt = obj.data("events"); for(var k in newevt) { if(unbind[k]) { if(!oevtctr[k]) { obj.unbind(k); } else if(newevt[k].length != oevtctr[k].length) { for(var i=0; i<newevt[k].length; i++) { if(!oevtctr[k][newevt[k][i]['guid']]) { obj.unbind(k, newevt[k][i]); } } } } } var tip = tipo.getTip(); if(tip) { tip.html(txt); if(typeof setting['tipClass'] == 'string') { tip.attr("class", setting['tipClass']); } } obj.attr("title", tmp); tipo.show(); return tipo; }, show_overlay : function (obj, id, html, setting) { var tmp = obj.attr("rel"); obj.attr("rel", '#'+id); var overobj = obj.overlay( setting ); obj.attr("rel", tmp); var ovl = obj.overlay(); if(ovl) { var ovlo = ovl.getOverlay(); if(ovlo) { ovlo.html(html); ovl.load(); } } return ovl; }, bgFrame : function () { }, parse_ntemplate : function (text, data) { for(var k in data) { var tof = typeof data[k]; var rtn = false; if(tof == 'string' || tof == 'boolean' || tof == 'number') { var regexp = new RegExp('##'+k+'##', 'gim'); text = text.replace(regexp, data[k]); if(tof == 'string') { rtn = (data[k] != ''); } else if(tof == 'boolean') { rtn = data[k]; } else if(tof == 'number') { rtn = data[k] > 0; var regexp = new RegExp('##CURRENCY:'+k+'##', 'gim'); var tmp = $.formatCurrency( data[k] ).replace('$', '$$$$'); text = text.replace(regexp, tmp ); } } else if(tof == 'undefined') { var regexp = new RegExp('##'+k+'##', 'gim'); text = text.replace(regexp, ''); } if(rtn) { var regexp = new RegExp('##IF:'+k+'##', 'gim'); text = text.replace(regexp, ''); regexp = new RegExp('##END IF:'+k+'##', 'gim'); text = text.replace(regexp, ''); var regexp = new RegExp('##IF:!'+k+'##.*?##END IF:!'+k+'##', 'gim'); text = text.replace(regexp, ''); } else { var regexp = new RegExp('##IF:'+k+'##.*?##END IF:'+k+'##', 'gim'); text = text.replace(regexp, ''); var regexp = new RegExp('##IF:!'+k+'##', 'gim'); text = text.replace(regexp, ''); regexp = new RegExp('##END IF:!'+k+'##', 'gim'); text = text.replace(regexp, ''); } } return text; }, escape_reserved : function (text) { return text.replace(/[!\"#$%&\'()\*+,\.\/:;<=>?@\[\\\]^`\{|\}~\s]/g, "\\$&"); }, is_empty : function (text) { if(text==null) { return true; } else if(text == '') {return true}; }, isEmpty : function (text) { if(typeof(text) == 'string') { return text.length == 0; } return true; }, trimSpace : function (text) { return $.trim(text); }, isTrue : function (t) { if(typeof(t) == 'string') { switch(t.toLowerCase()) { case 'y': case 'yes': case 'on': case 'true': case 'okay': case 'ok': case 't': case '1': return true; } } else if(typeof(t) == 'boolean') { return t; } else if(typeof(t) == 'number') { return t > 0; } return false; }, toInt : function (n, def) { if(typeof(n) == 'number') { return n; } else if(typeof(n) == 'string') { n = n.replace('$','').replace(' ','').replace(',',''); n = parseInt(n); if(isFinite(n)) { return n; } } if(typeof(def) == 'undefined') { return 0; } return def; }, toText : function (n) { if(typeof(n) == 'string') { return n; } else if(typeof(n) == 'undefined') { return ''; } else if(n === null) { return ''; } return ''+n; }, toFloat : function (n, def) { if(typeof(n) == 'number') { return n; } else if(typeof(n) == 'string') { n = n.replace('$','').replace(' ','').replace(',',''); n = parseFloat(n); if(isFinite(n)) { return n; } } if(typeof(def) == 'undefined') { return 0; } return def; }, timestamp : function () { return (new Date()).getTime(); }, randID : function () { return Math.floor(Math.random()*1000000); }, randString : function (len, str) { len = len || 32; if (typeof str != 'string') { str = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; } var m = str.length; var rtn = ''; for (var i=0; i<len; ++i) { var tmp = Math.floor(Math.random()*m); rtn += str[tmp]; } return rtn; }, hasCSSClass : function (c) { c = $.toText(c); var re= RegExp('\\b'+c+'\\b','i'); if( document.styleSheets ) { for(var i=document.styleSheets.length-1; i>=0; i--) { try { var s = document.styleSheets[i]; var r = (s.rules ? s.rules: s.cssRules); for(var j=0; j<r.length; j++){ var t = $.toText(r[j].selectorText? r[j].selectorText: r[j]+''); if(re.test(t)) { return true; } } } catch(err) { } } return false; } } }); }) (jQuery); (function($) { $.extend({ show_div_loading: function(div) { if($.isMobileView()) { $.mobile.showPageLoadingMsg(); } else { var binded = false; var evts = $(window).data('events'); for(var k in evts) { if(k=='resize') { for(var i=0; i<evts[k].length && !binded; i++) { if(evts[k][i]['namespace'] == 'loadingdiv') { binded = true; } } } } if(!binded) { $(window).bind('resize.loadingdiv', function () { $('.ajaxloader').each(function () { var div = $(this).attr('ref'); var a = $('#'+div); var b = a.offset(); var d = { left: b.left, top: b.top, width: a.outerWidth(), height: a.outerHeight()}; if(a.css('display') == 'none' || $(this).css('display') == 'none') { $(this).hide(); } else { $(this).show(); $(this).css({left: d.left+'px', top: d.top+'px', width: d.width+'px', height: d.height+'px'}); } }); }); } var a = $('#'+div); var b = a.offset(); var d = { left: b.left, top: b.top, width: a.outerWidth(), height: a.outerHeight()}; var loader = $('.ajaxloader[ref="'+div+'"]'); if(loader.length <= 0) { $('<div class="ajaxloader" ref="'+div+'" style="display:none;"></div>').css({'position': 'absolute', 'z-index': 20000}).appendTo(document.body); } loader = $('.ajaxloader[ref="'+div+'"]'); if(a.css('display') == 'none') { loader.hide(); } else { loader.css({left: d.left+'px', top: d.top+'px', width: d.width+'px', height: d.height+'px'}); loader.fadeIn(300); } } }, remove_div_loading: function(div) { if($.isMobileView()) { $.mobile.hidePageLoadingMsg(); } else { if(typeof(div) == 'undefined') { div=''; } $('.ajaxloader').each( function () { if(div=='' || $(this).attr('ref') == div) { $(this).fadeOut(300).css({left: '0px', top: '0px', width: '1px', height: '1px'}).hide(); } } ); } }, init_text_count : function (classname) { $('.'+classname).each(function(){ $.update_text_count($(this)); }); $('.'+classname+'_count').show(); $(document).on("keyup blur",'.'+classname,function(){ $.update_text_count($(this)); }); }, update_text_count : function (cur) { var id = cur.attr('id'); if(id == '') { id = cur.attr('name'); } var obj = $('#'+id+'ctr'); if(obj.length > 0) { var len = obj.attr('ref'); if(isNaN(len)) { len=0; } if(len > 0) { var val = ''+cur.val(); if(val.length > len) { val = val.substr(0,len); cur.val( val ); } obj.html(''+(len-val.length)); } } }, validate_email : function (email) { return email.match(/^[\d\w\.\#\$\%&\"\'\*\+\-\/=\?\^\`\{\|\}~_!]+@[\w\d\-]+(\.[\w\d\-]+)*$/); } }); }) (jQuery); /* END UTIL FUNCTIONS */ /* POPUP BOX FUNCTIONS */ $.fn.extend({ overlay: function(opt) { opt = $.extend({'visible':true}, opt); var z = 100000; if ( $('div.noverlay').length === 0 ) { $('<div class="noverlay"></div>').hide().css({'z-index': (z-1), left: '0px', top: '0px', opacity: .5, position: 'absolute', backgroundColor: '#000'}).appendTo(document.body); $(window).resize(function() { var ov = $('div.noverlay:visible'); ov.css({ width: $(document).width()+'px', height: $(document).height()+'px'}); }); } var o = $('div.noverlay'); o.css({width: $(document).width()+'px', height: $(document).height()+'px'}); if(opt['visible']) { var lv = 0; $('[overlay\-level^="lv"]').each(function() { var val = $(this).attr('overlay-level'); if(val) { val = $.toInt(val.replace(/^lv/, '')); if(val > lv) { lv = val; } } }); this.each(function() { $(this).attr('overlay-old-z-index', $(this).css('z-index')); $(this).attr('overlay-level', 'lv'+(lv+1)); $(this).css({'z-index': z+(lv*2)}); }); o.css({'z-index': (z-1)+(lv*2)}).show(); } else { var reqhide = false; this.each(function() { $(this).attr('overlay-level', ''); $(this).css({'z-index': $(this).attr('overlay-old-z-index')}); }); var lv = 0; $('[overlay\-level^="lv"]').each(function() { var val = $(this).attr('overlay-level'); if(val) { val = $.toInt(val.replace(/^lv/, '')); if(val > lv) { lv = val; } } }); lv -= 1; o.css({'z-index': (z-1)+(lv*2)}); if(lv < 0 ) { o.width(''); o.css({'width':'auto'}); o.hide(); } } return this; }, get_center_pos : function() { return { 'top': Math.round(((window.innerHeight? $.toInt(window.innerHeight) : $(window).height())-$(this).height())/2+$(window).scrollTop()), 'left': Math.round(($(window).width()-$(this).width())/2) }; }, move_center : function(anime) { var pos = $(this).get_center_pos(); var schi = (window.innerHeight? $.toInt(window.innerHeight) : $(window).height()); if($(this).height() >= schi ) { var coft = $(this).offset(); if( coft.top+$(this).height() <=$(window).scrollTop() || coft.top > $(window).scrollTop()+schi ) { pos['top'] = $(window).scrollTop(); } else { pos['top'] = coft.top; anime=0; } } if($(this).width() > $(window).width()) { pos['left'] = 0; } pos['top'] += 'px'; pos['left'] += 'px'; if(anime && anime > 0) { $(this).animate(pos, anime); } else { $(this).css(pos); } return this; } }); (function($) { $.extend({ nShowActivity : function (opt) { opt = $.soap_input_opt(opt, { 'has-overlay' : false, 'id' : '' }); $.nHideActivity(); var o; if($.isEmpty(opt['id'])) { o = $('div.nactivity:first'); } else { o = $('div.nactivity[nactivity-id="'+$.escape_reserved(opt['id'])+'"]:first'); } if ( o.length === 0 ) { o = $('<div class="nactivity">' + '<img src="/assets/loading.gif" alt="Loading...">' +'</div>').hide().attr({'nactivity-id': opt['id'] }).appendTo(document.body); if(!$.hasCSSClass('nactivity')) { $('<style type="text/css">'+ '.nactivity {'+ 'background: none repeat scroll 0 0 #000000;'+ 'border-radius: 6px 6px 6px 6px;'+ 'box-shadow: 0 5px 5px rgba(0, 0, 0, 0.5);'+ 'padding: 10px 10px 10px 10px;'+ '}'+ '</style>').appendTo($('head')); } } if( typeof( o.attr('npopup-status') ) == 'undefined' ) { o.css({'position': 'absolute'}).attr({'nactivity-status': 'ready' }); } o.move_center().attr({'nactivity-status': 'active' }).fadeIn(300).overlay({'visible': opt['has-overlay']}); }, nHideActivity : function () { var o = $('div.nactivity[nactivity-status="active"]').each(function () { $(this).fadeOut(300, function() { $(this).width(''); $(this).css({'width':'auto'}); $(this).hide(); }).attr({'nactivity-status': 'ready' }).overlay({'visible': false}); }); }, nPopupBoxRescroll : function (bo) { var sct = $(window).scrollTop(); var boffset = bo.offset(); var bto = boffset.top; var bhe = bo.height(); var whe = (window.innerHeight? $.toInt(window.innerHeight) : $(window).height()); var nv = bto + bhe - whe; if(whe > bhe) { if(sct > bto) { $(window).scrollTop(bto); } else if(sct < nv) { $(window).scrollTop(nv); } } else { if(sct > nv) { $(window).scrollTop(nv); } else if( sct < bto) { $(window).scrollTop(bto); } } }, nPopupBoxReposition : function (bo, opt) { opt = $.soap_input_opt(opt, { 'center' : false, 'hidden' : false, 'show' : false }); var oldoffset = bo.offset(); bo.width(''); bo.css({'width':'auto'}); if(opt['hidden'] || opt['show']) { bo.show(); } var wd = bo.width(); var mxw = $.toInt( bo.attr('npopup-max-width') ); if(mxw == 0 ) { mxw = $(window).width(); } if(mxw > 0 && wd > mxw) { wd = mxw; } var miw = $.toInt( bo.attr('npopup-min-width') ); if(wd < miw) { wd = miw; } bo.width($.toInt(wd)); if(opt['hidden']) { bo.hide(); } if(opt['center']) { bo.move_center(300); } }, nPopupBox : function (m, opt) { opt = $.soap_input_opt(opt, { 'width':'', 'min-width': 0, 'max-width': 0, 'duration' : 0, 'resize-duration' : 100, 'has-close-btn': true, 'has-overlay' : true, 'id' : '' /* onShow, onClose */ }); $.nHideActivity(); $.nClosePopupBox(); if( $('div.npopup[npopup-status]').length === 0 ) { $(window).resize(function() { $('div.npopup:visible[npopup-status="active"]').each(function () { var bo = $(this); bo.width(''); bo.css({'width':'auto'}); if(bo.data('npopup-resize-timer')) { clearTimeout(bo.data('npopup-resize-timer')); bo.removeData('npopup-resize-timer'); } var to = setTimeout( function () { $.nPopupBoxReposition(bo, {'center':true,'show':true}); }, opt['resize-duration']); bo.data('npopup-resize-timer', to); }); }); $(window).scroll(function(e) { $('div.npopup:visible[npopup-status="active"]').each(function () { var bo = $(this); if( $.isTrue(bo.attr('npopup-overlay')) ) { if(bo.data('npopup-resize-timer')) { clearTimeout(bo.data('npopup-resize-timer')); bo.removeData('npopup-resize-timer'); } $.nPopupBoxRescroll(bo); e.preventDefault(); } else { bo.width(''); bo.css({'width':'auto'}); if(bo.data('npopup-resize-timer')) { clearTimeout(bo.data('npopup-resize-timer')); bo.removeData('npopup-resize-timer'); } var to = setTimeout( function () { $.nPopupBoxReposition(bo, {'center':true,'show':true}); }, opt['resize-duration']); bo.data('npopup-resize-timer', to); } }); }); $(document).mouseup(function (e) { var o = $('div.npopup:visible[npopup-status="active"]').each(function () { if (!$(this).is(e.target) && $(this).has(e.target).length === 0) { $(this).find('.npopup-btn-close:first').click(); } }); }); } var o; if($.isEmpty(opt['id'])) { o = $('div.npopup:first'); } else { o = $('div.npopup[npopup-id="'+$.escape_reserved(opt['id'])+'"]:first'); } if ( o.length === 0 ) { o = $('<div class="npopup">' +'</div>').hide().attr({'npopup-id': opt['id'] }).appendTo(document.body); if(!$.hasCSSClass('npopup')) { $('<style type="text/css">'+ '.npopup {'+ 'display:none;'+ 'position: relative;'+ 'text-shadow: none;'+ 'background:#FFF;'+ '-webkit-border-radius: 4px;'+ '-moz-border-radius: 4px;'+ 'border-radius: 4px; '+ '-webkit-box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);'+ '-moz-box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);'+ 'box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);'+ 'height:auto;'+ 'width:auto;'+ 'margin:10px;'+ 'z-index:10000;'+ '}'+ '</style>').appendTo($('head')); } } if( typeof( o.attr('npopup-status') ) == 'undefined' ) { o.hide().css({'position': 'absolute'}).attr({'npopup-status': 'ready' }); } if( o.find('.npopup-btn-close').length == 0 ) { var btn = $('<a href="javascript:void(0);" class="npopup-btn-close"></a>').prependTo(o); if(!$.hasCSSClass('npopup-btn-close')) { $('<style type="text/css">'+ '.npopup-btn-close {'+ 'position: absolute;'+ 'top: -18px;'+ 'right: -18px;'+ 'width: 36px;'+ 'height: 36px;'+ 'cursor: pointer;'+ 'z-index: 8040; '+ '}'+ '.npopup-btn-close {'+ 'background-image: url(/assets/npopup_sprite.png);'+ '}'+ '</style>').appendTo($('head')); } } if( o.find('.npopup-body').length == 0 ) { var bdy = $('<div class="npopup-body">'+ '</div>').appendTo(o); if(!$.hasCSSClass('npopup-body')) { $('<style type="text/css">'+ '.npopup-body {'+ 'height:auto;'+ 'overflow:auto;'+ 'width:auto;'+ 'padding:10px; '+ '}'+ '</style>').appendTo($('head')); } } o.find('.npopup-btn-close').unbind('click'); o.find('.npopup-btn-close').bind('click', function () { var okay = true; var pr = $(this).closest('.npopup'); if( typeof(pr.data('onClose')) == 'function' ) { var prfn = pr.data('onClose'); var rtn = prfn(pr); if(typeof(rtn) == 'boolean' && !rtn) { okay=false; } } if(okay) { pr.removeData('onClose').attr({'npopup-status': 'ready' }).fadeOut(300, function() { pr.find('.npopup-body:first').html(''); pr.width(''); pr.css({'width':'auto'}); pr.hide().overlay({'visible': false}); }); $(this).prependTo(pr); pr.attr('npopup-width', ''); pr.attr('npopup-min-width', ''); pr.attr('npopup-max-width', ''); if(pr.data('npopup-resize-timer')) { clearTimeout(pr.data('npopup-resize-timer')); pr.removeData('npopup-resize-timer'); } if(pr.data('npopup-close-timer')) { clearTimeout(pr.data('npopup-close-timer')); pr.removeData('npopup-close-timer'); } } }); o.find('.npopup-body:first').html(m); if(opt['has-close-btn']) { o.find('.npopup-btn-close').show(); var hdro = o.find('.modal-header:first'); if( hdro.length > 0 ) { o.find('.npopup-btn-close:first').appendTo(hdro); } } else { o.find('.npopup-btn-close').hide(); } if( typeof(opt['onClose']) == 'function' ) { o.data('onClose', opt['onClose']); } else { o.removeData('onClose'); } o.attr('npopup-overlay', opt['has-overlay']); o.attr('npopup-width', opt['width']); o.attr('npopup-min-width', opt['min-width']); o.attr('npopup-max-width', opt['max-width']); if(!$.isEmpty(opt['width'])){ o.width(opt['width']); } else { $.nPopupBoxReposition(o, {'hidden':true}); } if( typeof(opt['onShow']) == 'function' ) { var rtn = opt['onShow'](o); } o.move_center().overlay({'visible': opt['has-overlay']}).fadeIn(300,function() { o.attr({'npopup-status': 'active' }); } ); if(o.data('npopup-resize-timer')) { clearTimeout(o.data('npopup-resize-timer')); o.removeData('npopup-resize-timer'); } if(o.data('npopup-close-timer')) { clearTimeout(o.data('npopup-close-timer')); o.removeData('npopup-close-timer'); } if( opt['duration'] > 0 ) { var to = setTimeout("$.nClosePopupBox()", opt['duration']); o.data('npopup-close-timer', to); } return o; }, nClosePopupBox : function () { var o = $('div.npopup[npopup-status="active"]').each(function () { $(this).find('.npopup-btn-close:first').click(); }); }, isChecked : function ( obj ) { var jquery_version = $.fn.jquery; var version_num = jquery_version.split(/\./); var use_attr = false; version_num[0] = $.toInt(version_num[0]); version_num[1] = $.toInt(version_num[1]); if(version_num[0] < 1  || (version_num[0] == 1 && version_num[1] < 6) ) { use_attr = true; } if(use_attr && obj.attr) { return obj.attr('checked'); } else { return obj.is(':checked'); } }, setChecked : function ( obj, val ) { var jquery_version = $.fn.jquery; var version_num = jquery_version.split(/\./); var use_attr = false; version_num[0] = $.toInt(version_num[0]); version_num[1] = $.toInt(version_num[1]); if(version_num[0] < 1  || (version_num[0] == 1 && version_num[1] < 6) ) { use_attr = true; } if(use_attr && obj.attr) { obj.attr('checked', val); } else { obj.prop('checked', val); } return obj; } }); }) (jQuery); /* END POPUP BOX FUNCTIONS */ /* COMMON FUNCTIONS */ function isEmpty (inputStr) { if ( null == inputStr || "" == inputStr ) { return true; } return false; } /* END COMMON */
/** INCLUDE jquery.neto.postcode_selector.js **/ /* POST CODE SELECTOR */ var nPSTRCache = { 'param' : {} }; (function($) { $.extend({ postcode_selectorInit : function(param) { var defvals = { 'page' : { 'header': '<div class="_sh_post_sel"><span>Please select your suburb below:</span><ul>', 'body': '<li><a href="javascript:##script##">##city##, ##state## ##zip##</a></li>', 'footer': '</ul></div>' }, 'selector' : { 'loading_msg' : 'Loading...', 'default_msg' : '-- Select Suburb / City --', 'empty_msg' : '-- Enter Valid Postal Code --' }, 'items_returned': 10, 'max_height': 300, 'closetimer_secs':5000, 'check_street' : false, 'street1_id': '_pst_street1', 'street2_id': '_pst_street2', 'country_id': '_pst_country', 'city_id': '_pst_city', 'state_id': '_pst_state', 'zip_id': '_pst_zip', 'id': '_pst_id', 'debug': false, 'fns' : {}, 'showparam': false }; param = $.soap_default_data(param ,defvals); if(param['showparam']) { alert($.js_var_dump(param)); } param['status'] = 'READY'; param['lastres'] = param['curval'] = param['curctry'] = param['curzip'] = ''; param['timer'] = param['closetimer'] = null; param['enable'] = 1; nPSTRCache['param'][param['id']] = param; var outid = '_pst_'+param['id']+'_pl'; var tmpobj = $('#'+outid); if(tmpobj.length <= 0) { $('body').append('<div id="'+outid+'" style="position:absolute; display: none; z-index: 20001;">&nbsp;</div>'); } if($.bgFrame()) { var bgid = '_pst_'+param['id']+'_bg'; var tmpobj = $('#'+bgid); if(tmpobj.length <= 0) { $('body').append('<iframe id="'+bgid+'" src="javascript:false;" scrolling="no" frameborder="0" style="position:absolute; display: none; z-index: 20000;"></iframe>'); } } var srcho = $('#'+param['id']); param['type'] = 'input'; if(srcho.length >0) { if($.isMobileView() || $.isJQVersion('>=','1.6')) { if(srcho.prop('tagName')) { if(srcho.prop('tagName').toUpperCase() != 'INPUT') { param['type'] = 'select'; } } } else { if(srcho.attr('tagName')) { if(srcho.attr('tagName').toUpperCase() != 'INPUT') { param['type'] = 'select'; } } } } else { param['type'] = 'none'; } var outo = $('#'+outid); var cityo = $('#'+param['city_id']); var zipo = $('#'+param['zip_id']); var stateo = $('#'+param['state_id']); var ctryo = $('#'+param['country_id']); if(param['check_street']) { var st1o = $('#'+param['street1_id']); var st2o = $('#'+param['street2_id']); $(document).off("change",st1o.selector); $(document).on("change",st1o.selector, function() { if(param) { if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } }); $(document).off("change",st2o.selector); $(document).on("change",st2o.selector, function() { if(param) { if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } }); } ctryo.attr("ref", param['id']); zipo.attr("ref", param['id']); $(document).off("change",cityo.selector); $(document).on("change",cityo.selector, function() { if(param) { if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } }); $(document).off("change",stateo.selector); $(document).on("change",stateo.selector, function() { if(param) { if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } }); $(document).off("change",ctryo.selector); $(document).on("change",ctryo.selector, function() { var obj = $(this); var id = obj.attr('ref'); var param = $.getPSTRCache(id); if(param) { param['enable'] = 0; var srcho = $('#'+param['id']); var ctryo = $('#'+param['country_id']); var srch =  srcho.val(); srch.replace(/^\s+|\s+$/g,''); var ctry =  ctryo.val(); ctry.replace(/^\s+|\s+$/g,''); var curval = ctry+'|'+srch; param['curval'] = curval; if(param['timer']) { clearTimeout(param['timer']); param['timer'] = null; } $('#' + param['city_id']).val(''); $('#' + param['zip_id']).val(''); $('#' + param['state_id']).val(''); $.postcode_change_country(id); if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } }); if(param['type'] == 'input') { if(typeof(param['fns']['onChange']) == 'function') { $(document).off("change",zipo.selector); $(document).on("change",zipo.selector, param['fns']['onChange'] ); } $(document).off("keyup keypress click",zipo.selector); $(document).on("keyup keypress click",zipo.selector, function(evt) { var flk = (evt.type == 'click' ? true:false); var obj = $(this); var id = obj.attr('ref'); var param = $.getPSTRCache(id); if(param) { if(param['enable']) { var zipo = $('#'+param['zip_id']); var zip =  zipo.val(); zip.replace(/^\s+|\s+$/g,''); if(param['curzip'] != zip || flk) { param['curzip'] = zip; if(param['status']=='READY') { param['status'] = 'LOADING'; if(param['timer']) { clearTimeout(param['timer']); param['timer'] = null; } param['timer'] = setTimeout( "$.postcode_lookup(unescape('"+escape(id)+"'),'z',"+(flk ? 'true':'false')+")", 1); } else { if(param['timer']) { clearTimeout(param['timer']); param['timer'] = null; } param['timer'] = setTimeout( "$.postcode_lookup(unescape('"+escape(id)+"'),'z',"+(flk ? 'true':'false')+")", 250); } } } } }); $(document).off("keyup keypress",srcho.selector); $(document).on("keyup keypress",srcho.selector, function(evt) { var flk = (evt.type == 'click' ? true:false); var obj = $(this); var id = obj.attr('id'); var param = $.getPSTRCache(id); if(param) { if(param['enable']) { var srcho = $('#'+param['id']); var ctryo = $('#'+param['country_id']); var srch =  srcho.val(); srch.replace(/^\s+|\s+$/g,''); var ctry =  ctryo.val(); ctry.replace(/^\s+|\s+$/g,''); var curval = ctry+'|'+srch; if(param['curval'] != curval || flk) { param['curval'] = curval; if(param['status']=='READY') { param['status'] = 'LOADING'; if(param['timer']) { clearTimeout(param['timer']); param['timer'] = null; } param['timer'] = setTimeout( "$.postcode_lookup(unescape('"+escape(id)+"'),'c',"+(flk ? 'true':'false')+")", 1); } else { if(param['timer']) { clearTimeout(param['timer']); param['timer'] = null; } param['timer'] = setTimeout( "$.postcode_lookup(unescape('"+escape(id)+"'),'c',"+(flk ? 'true':'false')+")", 250); } } } } }); $(document).off("change blur",srcho.selector); $(document).on("change blur",srcho.selector, function() { var obj = $(this); var id = obj.attr('id'); var param = $.getPSTRCache(id); if(param) { var cityo = $('#'+param['city_id']); if(param['enable']) { var zipo = $('#'+param['zip_id']); var stateo = $('#'+param['state_id']); var city = cityo.val(); var zip = zipo.val(); var state = stateo.val(); var curres = city+'|'+state+'|'+zip; var srcho = $('#'+param['id']); cityo.val(srcho.val()); } else { cityo.val(obj.val()); if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } if(param['closetimer']) { clearTimeout(param['closetimer']); param['closetimer'] = null; } param['closetimer'] = setTimeout( "$.postcode_pl_close(unescape('"+escape(id)+"'))", param['closetimer_secs']); } }); $(document).off("mouseout",srcho.selector); $(document).on("mouseout",srcho.selector, function() { var obj = $(this); var id = obj.attr('id'); var param = $.getPSTRCache(id); if(param) { if(param['closetimer']) { clearTimeout(param['closetimer']); param['closetimer'] = null; } param['closetimer'] = setTimeout( "$.postcode_pl_close(unescape('"+escape(id)+"'))", param['closetimer_secs']); } }); $(document).off("focus",srcho.selector); $(document).on("focus",srcho.selector, function() { var obj = $(this); var id = obj.attr('id'); var param = $.getPSTRCache(id); if(param) { if(param['closetimer']) { clearTimeout(param['closetimer']); param['closetimer'] = null; } } }); $(document).off("mouseout",outo.selector); $(document).on("mouseout",outo.selector, function() { var obj = $(this); var id = obj.attr('id'); id = id.replace(/^_pst_/,'').replace(/_pl$/,''); var param = $.getPSTRCache(id); if(param) { var cityo = $('#'+param['city_id']); var zipo = $('#'+param['zip_id']); var stateo = $('#'+param['state_id']); var city = cityo.val(); var zip = zipo.val(); var state = stateo.val(); var curres = city+'|'+state+'|'+zip; if(city != '') { var srcho = $('#'+param['id']); srcho.val(city); } if(param['closetimer']) { clearTimeout(param['closetimer']); param['closetimer'] = null; } param['closetimer'] = setTimeout( "$.postcode_pl_close(unescape('"+escape(id)+"'))", param['closetimer_secs']); } }); $(document).off("mouseenter mousemove",outo.selector); $(document).on("mouseenter mousemove",outo.selector, function() { var obj = $(this); var id = obj.attr('id'); id = id.replace(/^_pst_/,'').replace(/_pl$/,''); var param = $.getPSTRCache(id); if(param) { if(param['closetimer']) { clearTimeout(param['closetimer']); param['closetimer'] = null; } } }); } else if(param['type'] == 'none') { $(document).off("change",zipo.selector); $(document).on("change",zipo.selector, function(evt) { var obj = $(this); var id = obj.attr('ref'); var rparam = $.getPSTRCache(id); if($(this).val() != '') { if(typeof(rparam['fns']['onChange']) == 'function') { rparam['fns']['onChange'](); } } }); } else if(param['type'] == 'select') { $(document).off("keyup change",zipo.selector); $(document).on("keyup change",zipo.selector, function(evt) { var obj = $(this); var id = obj.attr('ref'); if($(this).val().length >= 4 || evt.type =='change'){ $.load_city_selector(id); } }); } $.postcode_change_country(param['id']); }, /* ## SIMON ## */ load_city_selector : function (id) { var param = $.getPSTRCache(id); if(param) { var srcho = $('#'+param['id']); var ctryo = $('#'+param['country_id']); var cityo = $('#'+param['city_id']); if(param['enable']) { param['status'] = 'LOADING'; cityo.hide(); srcho.show(); var ctry =  ctryo.val(); if (typeof ctry == 'undefined') { ctry = ''; } ctry.replace(/^\s+|\s+$/g,''); var zipo = $('#'+param['zip_id']); var zip =  zipo.val(); if (typeof zip == 'undefined') { zip = ''; } zip.replace(/^\s+|\s+$/g,''); var curzip = zip; if(param['curzip'] != curzip || param['curctry'] != ctry) { srcho.html('<select id="'+param['id']+'_cysel" data-mini="true"><option value="">'+param['selector']['loading_msg']+'</option></select>'); if($.isMobileView()) { srcho.trigger('create'); } var selo = $('#'+param['id']+'_cysel'); selo.unbind("change"); if(!$.isMobileView()) { selo.attr('disabled', 'disabled'); } param['curzip'] = curzip; param['curctry'] = ctry; var fn = 'postcode_selector'; $.do_ajax( fn, {'proc':'lookupbyzip',	'input': zip, 'country': ctry }, true, { 'SUCCESS': { 'def' : { 'keyword':'', 'loc':[], 'enable':0 }, 'fn' : function (code, data) { param['enable'] = data['enable']; var srcho = $('#'+param['id']); var cityo = $('#'+param['city_id']); if(data['enable']) { var zipo = $('#'+param['zip_id']); var ctr = data['loc']; var html = '<select id="'+param['id']+'_cysel" data-mini="true">'; var hassel = false; if(ctr.length > 0) { html += '<option value="">'+param['selector']['default_msg']+'</option>'; for (var i=0; i<ctr.length; i++) { var selected = ''; if(cityo.val()==ctr[i]['c']) { hassel = true; selected = 'selected'; } html += '<option value="'+ctr[i]['c']+';'+ctr[i]['s']+'" '+selected+'>'+ctr[i]['c']+'</option>'; } } else { html += '<option value="">'+param['selector']['empty_msg']+'</option>'; } html += '</select>'; srcho.html(html); if($.isMobileView()) { srcho.trigger('create'); } var selo = $('#'+param['id']+'_cysel'); if(ctr.length > 0) { if(!$.isMobileView()) { selo.removeAttr('disabled'); } selo.unbind("change"); selo.bind("change", function(evt) { var rid = $(this).attr('id'); rid=rid.replace(/_cysel$/,''); var rparam = $.getPSTRCache(rid); var cityo = $('#'+rparam['city_id']); var stateo = $('#'+rparam['state_id']); var statesel = $('#'+rparam['state_id']+'_sel'); if($(this).val() != '') { var cityv = $(this).val(); var arr = cityv.split(';'); if(!$.isMobileView()) { cityo.val(arr[0]); } else { cityo.attr("value",arr[0]); $(this).prev("span:last").children("span:first").html(arr[0]); } if(arr.length > 1) { stateo.val(arr[1]); statesel.val(arr[1]); } if(typeof(rparam['fns']['onChange']) == 'function') { rparam['fns']['onChange'](); } } }); if(hassel) { if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } } else { if(!$.isMobileView()) { selo.attr('disabled', 'disabled'); } selo.unbind("change"); } } else { srcho.hide(); cityo.show(); } param['status'] = 'READY'; } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if(data['msg']) { var msg = $.parse_ntemplate(data['msg']); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { } } }); } } else { srcho.hide(); cityo.show(); } } }, /* ## SIMON END ## */ postcode_pl_close : function ( id ) { var param = $.getPSTRCache(id); if(param) { var outid = '_pst_'+param['id']+'_pl'; var outo = $('#'+outid); outo.css('display', 'none'); if($.bgFrame()) { var bgid = '_pst_'+param['id']+'_bg'; var bgo = $('#'+bgid); bgo.css('display', 'none'); } if(param['timer']) { clearTimeout(param['timer']); param['timer'] = null; } if(param['closetimer']) { clearTimeout(param['closetimer']); param['closetimer'] = null; } } }, /** Lookup Function **/ postcode_change_country : function (id) { var fn = 'postcode_selector'; var param = $.getPSTRCache(id); if(param) { var srcho = $('#'+param['id']); var ctryo = $('#'+param['country_id']); var ctry =  ctryo.val(); ctry.replace(/^\s+|\s+$/g,''); var cityo = $('#'+param['city_id']); srcho.val(cityo.val()); param['status'] = 'LOADING'; $.do_ajax( fn, {'proc':'switch',	'country': ctry}, true, { 'SUCCESS': { 'def' : { 'keyword':'', 'state':[], 'enable':0 }, 'fn' : function (code, data) { param['enable'] = data['enable']; var ctr = data['state']; var statepl = $('#'+param['state_id']+'_pl'); var cityo = $('#'+param['city_id']); var zipo = $('#'+param['zip_id']); var stateo = $('#'+param['state_id']); if(statepl.length > 0) { if(ctr.length > 0) { var selid = param['state_id']+'_sel'; var html = '<select id="'+selid+'" data-mini="true">'; html += '<option value=""></option>'; for (var i=0; i<ctr.length; i++) { html += '<option value="'+ctr[i]['s']+'">'+ctr[i]['n']+'</option>'; } html += '</select>'; statepl.html(html); if($.isMobileView()) { statepl.trigger('create'); } var statesel = $('#'+selid); statesel.attr('ref', param['id']); statesel.val( stateo.val() ); if($.isMobileView()) { statesel.selectmenu("refresh"); } statepl.css('display', ''); stateo.css('display', 'none'); $("label[for='" + param['state_id'] +"'] div").show(); statesel.unbind('change'); statesel.bind("change", function(){ var obj = $(this); var id = obj.attr('ref'); if($.isMobileView()) { obj.selectmenu("refresh"); } var param = $.getPSTRCache(id); if(param) { var stateo = $('#'+param['state_id']); stateo.val(obj.val()); if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } }); } else { statepl.html(''); if($.isMobileView()) { statepl.trigger('create'); } statepl.css('display', 'none'); stateo.css('display', ''); $("label[for='" + param['state_id'] +"'] div").hide(); } } /* ## SIMON ## */ var statesel = $('#'+param['state_id']+'_sel'); if(param['type'] == 'select') { $.load_city_selector(id); } /* ## SIMON END ## */ param['status'] = 'READY'; } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if(data['msg']) { var msg = $.parse_ntemplate(data['msg']); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { } } }); } }, /** Lookup Function **/ postcode_lookup : function (id, typ, flk) { var fn = 'postcode_selector'; var param = $.getPSTRCache(id); if(param) { var srcho = $('#'+param['id']); var ctryo = $('#'+param['country_id']); var cityo = $('#'+param['city_id']); var srch =  srcho.val(); srch.replace(/^\s+|\s+$/g,''); var ctry =  ctryo.val(); ctry.replace(/^\s+|\s+$/g,''); var curval = ctry+'|'+srch; if(typ == 'z') { var zipo = $('#'+param['zip_id']); var zip =  zipo.val(); zip.replace(/^\s+|\s+$/g,''); var curzip = zip; if(param['curzip'] == curzip || flk) { param['curzip'] = curzip; $.do_ajax( fn, {'proc':'lookupbyzip',	'input': zip, 'country': ctry, 'limit': param['items_returned']}, true, { 'SUCCESS': { 'def' : { 'keyword':'', 'loc':[], 'enable':0 }, 'fn' : function (code, data) { param['enable'] = data['enable']; var srcho = $('#'+param['id']); if(data['enable']) { var zipo = $('#'+param['zip_id']); var ctr = data['loc']; var pdata = {'id': param['id'] }; var html = ''; if(ctr.length > 0) { html += $.parse_ntemplate(param['page']['header'], pdata); for (var i=0; i<ctr.length; i++) { var tmp = { 'city' : ctr[i]['c'], 'state_code' : ctr[i]['s'], 'state' : ctr[i]['f'], 'zip' : ctr[i]['z'], 'script' : "$.setPSTRValue('"+escape(escape(id))+"', '"+escape(escape(ctr[i]['c']))+"','"+escape(escape(ctr[i]['s']))+"','"+escape(escape(ctr[i]['z']))+"', '', true);" }; html += $.parse_ntemplate(param['page']['body'], tmp); } html += $.parse_ntemplate(param['page']['footer'], pdata); } var outid = '_pst_'+param['id']+'_pl'; var outo = $('#'+outid); outo.html(html); if($.isMobileView()) { outo.trigger('create'); } outo.css('display', ''); var offset = zipo.offset(); offset.top += zipo.outerHeight(); outo.offset(offset); if(outo.height() > param['max_height']) { outo.height( param['max_height'] ); outo.css( 'overflow', 'auto'); } if($.bgFrame()) { var bgid = '_pst_'+param['id']+'_bg'; var bgo = $('#'+bgid); bgo.offset(outo.offset()); bgo.height(outo.height()); bgo.width(outo.width()); bgo.css('display', ''); } if(ctr.length == 1) { $.setPSTRValue(id, ctr[0]['c'],ctr[0]['s'],ctr[0]['z'], data['keyword']); } if(param['closetimer']) { clearTimeout(param['closetimer']); param['closetimer'] = null; } param['closetimer'] = setTimeout( "$.postcode_pl_close(unescape('"+escape(id)+"'))", param['closetimer_secs']); } param['status'] = 'READY'; } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if(data['msg']) { var msg = $.parse_ntemplate(data['msg']); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { } } }); } } else if(param['enable'] && (srch == '' || ctry == '')) { param['status'] = 'READY'; var outid = '_pst_'+param['id']+'_pl'; var outo = $('#'+outid); outo.css('display', 'none'); outo.html(''); if($.isMobileView()) { outo.trigger('create'); } var offset = srcho.offset(); offset.top += srcho.height(); outo.offset(offset); if($.bgFrame()) { var bgid = '_pst_'+param['id']+'_bg'; var bgo = $('#'+bgid); bgo.offset(outo.offset()); bgo.height(outo.height()); bgo.width(outo.width()); bgo.css('display', 'none'); } } else if(param['curval'] == curval || flk) { param['curval'] = curval; $.do_ajax( fn, {'proc':'lookup',	'input': srch, 'country': ctry, 'limit': param['items_returned']}, true, { 'SUCCESS': { 'def' : { 'keyword':'', 'loc':[], 'enable':0 }, 'fn' : function (code, data) { param['enable'] = data['enable']; var srcho = $('#'+param['id']); if(data['enable']) { var cityo = $('#'+param['city_id']); var zipo = $('#'+param['zip_id']); var stateo = $('#'+param['state_id']); var ctr = data['loc']; var pdata = {'id': param['id'] }; var html = ''; var selcty = ''; if(ctr.length > 0) { html += $.parse_ntemplate(param['page']['header'], pdata); for (var i=0; i<ctr.length; i++) { if(i==0) { selcty = ctr[i]['c']; } else if(selcty != '' &&  ctr[i]['c'].indexOf(selcty)!=0 ) { selcty=''; } var tmp = { 'city' : ctr[i]['c'], 'state_code' : ctr[i]['s'], 'state' : ctr[i]['f'], 'zip' : ctr[i]['z'], 'script' : "$.setPSTRValue('"+escape(escape(id))+"', '"+escape(escape(ctr[i]['c']))+"','"+escape(escape(ctr[i]['s']))+"','"+escape(escape(ctr[i]['z']))+"', '', true);" }; html += $.parse_ntemplate(param['page']['body'], tmp); } html += $.parse_ntemplate(param['page']['footer'], pdata); } var outid = '_pst_'+param['id']+'_pl'; var outo = $('#'+outid); outo.html(html); if($.isMobileView()) { outo.trigger('create'); } outo.css('display', ''); var offset = srcho.offset(); offset.top += srcho.outerHeight(); outo.offset(offset); if(outo.height() > param['max_height']) { outo.height( param['max_height'] ); outo.css( 'overflow', 'auto'); } if($.bgFrame()) { var bgid = '_pst_'+param['id']+'_bg'; var bgo = $('#'+bgid); bgo.offset(outo.offset()); bgo.height(outo.height()); bgo.width(outo.width()); bgo.css('display', ''); } if(selcty != '') { if(ctr.length == 1) { $.setPSTRValue(id, ctr[0]['c'],ctr[0]['s'],ctr[0]['z'], data['keyword']); } else { $.setPSTRValue(id, ctr[0]['c'],null,null, data['keyword']); } } if(param['closetimer']) { clearTimeout(param['closetimer']); param['closetimer'] = null; } param['closetimer'] = setTimeout( "$.postcode_pl_close(unescape('"+escape(id)+"'))", param['closetimer_secs']); } else { var cityo = $('#'+param['city_id']); var zipo = $('#'+param['zip_id']); var stateo = $('#'+param['state_id']); cityo.val(srcho.val()); } param['status'] = 'READY'; } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if(data['msg']) { var msg = $.parse_ntemplate(data['msg']); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { } } }); } } }, setPSTRValue : function(id, city, state,zip ,keyword, esp) { if(!keyword) { keyword=''; } keyword = keyword.toUpperCase(); if(esp) { id = unescape(id); city = unescape(city); zip = unescape(zip); state = unescape(state); } var param = $.getPSTRCache(id); if(param) { var nochg = false; var cityo = $('#'+param['city_id']); var zipo = $('#'+param['zip_id']); var stateo = $('#'+param['state_id']); if(zip == null) {  zip = zipo.val(); nochg = true; } if(state == null) {  state = stateo.val(); nochg = true; } cityo.val(city); zipo.val(zip); stateo.val(state); var selid = param['state_id']+'_sel'; var statesel = $('#'+selid); if(statesel.length > 0) { statesel.val( state ); if($.isMobileView()) { statesel.selectmenu("refresh"); } } var curres = city+'|'+state+'|'+zip; if(city != '' && state != '' && zip != '' && param['lastres'] != curres) { var srcho = $('#'+param['id']); srcho.val(city); } var srcho = $('#'+param['id']); var ctryo = $('#'+param['country_id']); var srch =  srcho.val(); srch.replace(/^\s+|\s+$/g,''); var ctry =  ctryo.val(); ctry.replace(/^\s+|\s+$/g,''); var curval = ctry+'|'+srch; param['curval'] = curval; var newval = srcho.val(); /** select when you type **/ if(keyword != '' && param['lastres'] != curres) { var pos = newval.indexOf(keyword); if(pos >= 0 ) { pos += keyword.length; pend = newval.length; var obj = document.getElementById(param['id']); if(obj) { if (obj.setSelectionRange) { obj.focus(); obj.setSelectionRange(pos, pend); } else if(obj.createTextRange) { var range = obj.createTextRange(); range.collapse(true); range.moveEnd('character', pend); range.moveStart('character', pos); range.select(); } } } } if(typeof(param['fns']['onChange']) == 'function' && !nochg) { if(param['lastres'] != curres) { param['fns']['onChange'](); } } param['lastres'] = curres; if(esp) { $.postcode_pl_close(id); } } }, getPSTRCache : function ( id ) { return nPSTRCache['param'][id]; } }); })(jQuery); /* END POST CODE SELECTOR */
/** INCLUDE jquery.neto.stock_notifier.js **/ /* BACK IN STOCK NOTIFICATION */ (function($) { $.extend({ addNotifyBackInStock: function(sku, opts) { opts = $.extend({ 'full_name': 'from_name', 'email_address': 'from', 'popup_timeout': 1500, 'msg' : { 'ITEM_NOT_FOUND': 'Item Not Found', 'NOTIFICATION_ADDED': 'Notification Added', 'NOTIFICATION_UPDATED': 'Notification Updated' }, 'fns' : { 'SUCCESS' : null }, 'debug': false, 'showparam': false }, opts); /* get form vars */ var from_name = ( opts.hasOwnProperty('from_name') ? opts['from_name'] : $('#'+opts['full_name']).val() ); var from = ( opts.hasOwnProperty('from') ? opts['from'] : $('#'+opts['email_address']).val() ); var fn = 'notifyme'; $.nShowActivity(); $.do_ajax( fn, {'proc':'Add', 'sku':sku, 'from_name':from_name, 'from':from}, true, { 'SUCCESS': { 'def' : { 'ind': 0, 'sku': '', 'url': '', 'brand': '', 'name': '', 'price': 0, 'qty': 0, 'image': '', 'extra':'', 'total': { 'product_total': '', 'shipping_total': '', 'item_count':0 }, 'msg':'' }, 'fn' : ( typeof opts['fns']['SUCCESS'] == 'function' ? opts['fns']['SUCCESS'] : function (code, data) { if( opts['msg'][data['msg']] ) { $.nPopupBox(opts['msg'][data['msg']], {'duration': opts['popup_timeout']}); } } ) }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if( opts['msg'][data['msg']] ) { $.nPopupBox(opts['msg'][data['msg']], {'duration': opts['popup_timeout']}); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } } ); }, addNotifyContent : function(content_id, opts) { opts = $.extend({ 'full_name_selector': '#full_name', 'email_address_selector': '#email_address', 'popup_timeout': 1500, 'msg' : { 'CONTENT_NOT_FOUND': 'Content Not Found', 'NOTIFICATION_ADDED': 'Notification Added', 'NO_EMAIL_ADDRESS': 'Email address not supplied' }, 'debug': false, 'showparam': false }, opts); /* get form vars */ var full_name = $(opts['full_name_selector']).val(); var email_address = $(opts['email_address_selector']).val(); var fn = 'notifyme_content'; $.nShowActivity(); if (email_address != '') { $.do_ajax( fn, {'proc':'Add', 'content_id':content_id, 'full_name':full_name, 'email_address':email_address}, true, { 'SUCCESS': { 'def' : { 'ind': 0, 'content_id': '', 'url': '', 'brand': '', 'name': '', 'price': 0, 'qty': 0, 'image': '', 'extra':'', 'total': { 'product_total': '', 'shipping_total': '', 'item_count':0 }, 'msg':'' }, 'fn' : function (code, data) { if( opts['msg'][data['msg']] ) { $.nPopupBox(opts['msg'][data['msg']], {'duration': opts['popup_timeout']}); } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if( opts['msg'][data['msg']] ) { $.nPopupBox(opts['msg'][data['msg']], {'duration': opts['popup_timeout']}); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } }); } else { $.nPopupBox(opts['msg']['NO_EMAIL_ADDRESS'], {'duration': opts['popup_timeout']}); } } }); })(jQuery); /* END BACK IN STOCK NOTIFICATION */
/** INCLUDE jquery.neto.store_locator.js **/ /* STORE LOCATION FUNCTIONS */ var nStoreLocatorData = new Object(); (function($) { $.extend({ storeLocator_Init: function(param) { var defvals = { 'zip_id': 'geo_zip', 'country_id': 'geo_country', 'radius_id': 'geo_radius', 'limit_id': 'geo_limit', 'button_id': 'geo_search', 'nearby_id': 'geo_nearby', 'selector_id': 'geo_location_selector', 'addr_input': 'geo_addr', 'category_input': 'geo_category', 'list_id': 'geo_list', 'misc_id': 'geo_misc', 'map_id': 'geo_map', 'zoom_country': 4, 'zoom_suburb': 12, 'zoom_preset': 12, 'default_lat': -27.000, 'default_lng': 133.000, 'default_country' : '', 'default_radius' : 5, 'default_limit' : 10, 'item_class' : 'geo_loc_item', 'list_class' : 'geo_loc_list', 'info_class' : 'geo_loc_info', 'highlight_class' : 'geo_highlight', 'marker' : { 'icon' : '', 'cursor' : '' }, 'msg' : { 'noresult' : 'Sorry. No results found.' }, 'page' : { 'result' : '<div class="resultmsg">##count## result(s) found</div>', 'header': '<div class="##list_class##">##msg##<br clear="all"><ul>', 'body': '<li class="##item_class##" ref="##count##">##IF:thumb##<div class="thumb"><img width="40px" src="##thumb##" border="0"></div>##END IF:thumb##'+ '<a href="javascript:##script##">##name##</a><br>'+ '<span class="address">##street##, ##city##, ##state## ##zip##</span><br>'+ '<span class="distance">(##distance##km from your location)</span><br>'+ '##IF:phone##<span class="contact"><b>PH:</b> ##phone##</span>##END IF:phone##'+ '##IF:fax##<span class="contact"><b>Fax:</b> ##fax##</span>##END IF:fax##'+ '##IF:email##<span class="contact"><b>Email:</b> ##email##</span>##END IF:email##'+ '</li>', 'footer': '</ul></div>', 'info': '<div class="##info_class##">##IF:thumb##<div class="thumb"><img src="##thumb##" border="0"></div>##END IF:thumb##'+ '<a href="##url##">##name##</a><br>'+ '<span class="address">##street##, ##city##, ##state## ##zip##</span><br>'+ '<span class="distance">(##distance##km from your location)</span><br>'+ '##IF:phone##<span class="contact"><b>PH:</b> ##phone##</span>##END IF:phone##'+ '##IF:fax##<span class="contact"><b>Fax:</b> ##fax##</span>##END IF:fax##'+ '##IF:email##<span class="contact"><b>Email:</b> ##email##</span>##END IF:email##'+ '</div>' }, 'debug': false, 'showparam': false }; param = $.soap_default_data(param ,defvals); if(param['showparam']) { alert($.js_var_dump(param)); } if(typeof(param['onSetLocation']) != 'function') { param['onSetLocation'] = null; } nStoreLocatorData['param'] = param; nStoreLocatorData['map'] = null; nStoreLocatorData['info'] = null; nStoreLocatorData['markers'] = []; nStoreLocatorData['param']['default_country'] = $('#'+param['country_id']).val(); try { nStoreLocatorData['map'] = new google.maps.Map(document.getElementById(param['map_id']), { zoom: param['zoom_country'], center: new google.maps.LatLng(param['default_lat'], param['default_lng']), mapTypeId: google.maps.MapTypeId.ROADMAP, mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU} }); nStoreLocatorData['info'] = new google.maps.InfoWindow(); var addrinp = []; $('[name="'+param['addr_input']+'"]').each(function () { var val = $(this).val(); if(val != '') { addrinp.push(val); } }); $.geoSearchStores( $('#'+param['country_id']).val(), $('#'+param['zip_id']).val(), addrinp ); var btno = $('#'+param['button_id']); $(document).off("click",btno.selector); $(document).on("click",btno.selector,function() { var bparam = $.getStoreLocatorCache('param'); var baddrinp = []; $('[name="'+bparam['addr_input']+'"]').each(function () { var val = $(this).val(); if(val != '') { baddrinp.push(val); } }); $.geoSearchStores( $('#'+bparam['country_id']).val(), $('#'+bparam['zip_id']).val(), baddrinp ); }); $(document).on("click",'#'+param['nearby_id'],function(){ $.geoStartSearch(); }); } catch (e) { if(param['debug']) { alert('Error: Cannot Load Store Locator.'); } } }, geoGoToLocation: function(country, address) { var param = $.getStoreLocatorCache('param'); var opts = { 'region':country }; var hasaddr = false; var hascty = (country == param['default_country']); if(!address) { address=''; } if(address != '') { opts['address'] = address; hasaddr = true; } try { var coder = new google.maps.Geocoder(); coder.geocode(opts, function (res, status) { if (status == google.maps.GeocoderStatus.OK) { $.geoSetLocation(res, {'hasaddr':hasaddr, 'country':country, 'search':false}); } else if(hasaddr) { $.geoGoToLocation(country); } else if(!hascty) { $.geoGoToLocation(param['default_country']); } }); } catch (e) { if(param['debug']) { alert('Error: Cannot Load Store Locator.'); } } }, geoSearchStores: function(country, zip, address) { var param = $.getStoreLocatorCache('param'); var opts = { 'region':country, 'address':'' }; if(!address) { address=[];} if(!zip) { zip='';} var hasaddr = false; var haszip = false; var hascty = (country == param['default_country']); for(var i=0; i<address.length; i++) { if(address[i] != '') { opts['address'] += address[i]+', '; hasaddr=true; } } if(zip != '') { opts['address'] += zip+', '+country; haszip=true; } try { var coder = new google.maps.Geocoder(); coder.geocode(opts, function (res, status) { if (status == google.maps.GeocoderStatus.OK) { $.geoSetLocation(res, {'hasaddr': (hasaddr || haszip), 'country':country, 'search':true}); } else if(hasaddr) { $.geoSearchStores(country, zip); } else if(haszip) { $.geoSearchStores(country); } else if(!hascty) { $.geoSearchStores(param['default_country']); } }); } catch (e) { if(param['debug']) { alert('Error: Cannot Load Store Locator.'); } } }, geoCleartMarkers : function () { var param = $.getStoreLocatorCache('param'); var markers = $.getStoreLocatorCache('markers'); while(markers.length > 0) { var mko = markers.pop(); mko.setMap(null); } var pl = $('#'+param['selector_id']+'_pl'); if(pl.length) { pl.html(''); pl.hide(); } }, geoSetLocation : function (res, opts) { var param = $.getStoreLocatorCache('param'); var map = $.getStoreLocatorCache('map'); if(res.length > 0) { var found = -1; for(var i=0; found<0 && i<res.length; i++) { var acom = res[i].address_components; for(var j=0; found<0 && j<acom.length; j++) { for(var k=0; found<0 && k<acom[j].types.length; k++) { if(acom[j].types[k] == 'country') { if(acom[j].short_name.toUpperCase() == opts['country']) { found=i; } } } } } if(found >= 0) { $.geoCleartMarkers(); map.setCenter(res[found].geometry.location); if(opts['hasaddr']) { map.setZoom(param['zoom_suburb']); } else { map.setZoom(param['zoom_country']); } if(opts['search']) { $.geoStartSearch(); } if(typeof(param['onSetLocation']) == 'function') { param['onSetLocation'](res[found]); } } } }, geoStartSearch : function () { var param = $.getStoreLocatorCache('param'); var map = $.getStoreLocatorCache('map'); var rad = $('#'+param['radius_id']).val(); rad = parseFloat(rad); if(isNaN(rad)) { rad=param['default_radius']; } var limit = $('#'+param['limit_id']).val(); limit = parseInt(limit); if(isNaN(limit)) { limit=param['default_limit']; } var lat = map.getCenter().lat(); var lng = map.getCenter().lng(); var cat = []; var tmpcat = {}; $('[name="'+param['category_input']+'"]').each(function () { var val = $(this).val(); if(val != '' && !tmpcat[val]) { cat.push(val); tmpcat[val] = true; } }); var misc = {}; $('[name="'+param['misc_id']+'"]').each(function () { var id = $(this).attr('ref'); var val = $(this).val(); if(val != '' && !misc[id]) { misc[id] = val; } }); var fn = 'store_locator'; $.do_ajax( fn, { 'proc':'search', 'lat': lat, 'lng': lng, 'rad':rad, 'limit':limit, 'category':cat.join(';'),'misc':misc }, true, { 'SUCCESS': { 'def' : { 'count': 0, 'loc': [], 'lat': 0, 'lng': 0, 'rad': 0 }, 'fn' : function (code, data) { var param = $.getStoreLocatorCache('param'); var map = $.getStoreLocatorCache('map'); var bounds = new google.maps.LatLngBounds(); map.setCenter(new google.maps.LatLng(data['lat'],data['lng'])); var zoom = param['zoom_preset']; if(data['rad'] < 2 ) { zoom += 3; } else if(data['rad'] < 5 ) { zoom += 2; } else if(data['rad'] < 10 ) { zoom += 1; } else if(data['rad'] < 25 ) { } else if(data['rad'] < 50 ) { zoom -= 1; } else if(data['rad'] < 100 ) { zoom -= 2; } else { zoom -= 2+Math.round(data['rad'] / 100); } if(zoom < 0) { zoom=0; } map.setZoom(zoom); var listo = $('#'+param['list_id']); $.geoCleartMarkers(); var markers = $.getStoreLocatorCache('markers'); var definp = { 'thumb': '', 'url': '', 'phone': '', 'fax': '', 'email': '', 'name': '', 'street': '', 'city': '', 'state': '', 'zip': '', 'country': '', 'distance': 0, 'lat': 0, 'lng': 0 }; var html = ''; var ctr = 0; for(var i=0; i<data['loc'].length; i++) { var tmp = $.soap_default_data(data['loc'][i],definp); tmp['script'] = '$.geoSelectLocation('+ctr+');'; tmp['info_class'] = param['info_class']; tmp['list_class'] = param['list_class']; tmp['item_class'] = param['item_class']; tmp['count'] = ctr; html += $.parse_ntemplate(param['page']['body'], tmp); var latlng = new google.maps.LatLng(tmp['lat'],tmp['lng']); var mkopts = { map: map, position: latlng }; if(tmp['name'] != '') { mkopts['title'] = tmp['name']; } if(param['marker']['icon'] != '') { mkopts['icon'] = param['marker']['icon']; } if(param['marker']['cursor'] != '') { mkopts['cursor'] = param['marker']['cursor']; } var newMarker = $.geoCreateMarker(mkopts, tmp, ctr); markers.push(newMarker); bounds.extend(latlng); ctr++; } var pdata = {'count': ctr}; pdata['info_class'] = param['info_class']; pdata['list_class'] = param['list_class']; pdata['item_class'] = param['item_class']; if(ctr >0) { pdata['msg'] = $.parse_ntemplate(param['page']['result'], pdata); } else { pdata['msg'] = param['msg']['noresult']; } html = $.parse_ntemplate(param['page']['header'], pdata)+ html + $.parse_ntemplate(param['page']['footer'], pdata); if(listo.length) { listo.html(html); listo.show(); var itms = $('.'+param['list_class']+' UL LI.'+param['item_class']); $(document).off("click",itms.selector); $(document).on("click",itms.selector,function(){ $.geoSelectLocation($(this).attr('ref')); }); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } }); }, geoCreateMarker : function (mkopts, data, ctr) { var param = $.getStoreLocatorCache('param'); var map = $.getStoreLocatorCache('map'); var info = $.getStoreLocatorCache('info'); var markers = $.getStoreLocatorCache('markers'); var html = $.parse_ntemplate(param['page']['info'], data); var marker = new google.maps.Marker(mkopts); google.maps.event.addListener(marker, 'click', function(e) { $.geoHighLightMarker(ctr); info.setContent(html); info.open(map, marker); }); return marker; }, geoCustAddMarker : function (lat,lng, name) { var param = $.getStoreLocatorCache('param'); var map = $.getStoreLocatorCache('map'); var markers = $.getStoreLocatorCache('markers'); var bounds = new google.maps.LatLngBounds(); var latlng = new google.maps.LatLng(lat,lng); var mkopts = { map: map, position: latlng }; if(name != '') { mkopts['title'] = name; } if(param['marker']['icon'] != '') { mkopts['icon'] = param['marker_icon']; } if(param['marker']['cursor'] != '') { mkopts['cursor'] = param['marker']['cursor']; } var newMarker = new google.maps.Marker(mkopts); markers.push(newMarker); bounds.extend(latlng); }, geoHighLightMarker : function (id) { var param = $.getStoreLocatorCache('param'); $('.'+param['list_class']+' UL LI.'+param['item_class']).each(function () { var ref = $(this).attr('ref'); if(ref == id) { $(this).addClass(param['highlight_class']); } else { $(this).removeClass(param['highlight_class']); } }); }, geoSelectLocation : function ( ind ) { var markers = $.getStoreLocatorCache('markers'); ind = parseInt(ind); if(isNaN(ind)) { ind=-1; } if(ind >= 0) { google.maps.event.trigger(markers[ind], 'click'); } }, getStoreLocatorCache : function ( id ) { if(nStoreLocatorData[id] instanceof Object) { return nStoreLocatorData[id]; } else { return {}; } } }); }) (jQuery); /* END STORE LOCATION  FUNCTIONS*/
/** INCLUDE jquery.neto.variations.js **/ /* PRODUCT VARIATIONS */ var nITMVARCache = {}; var nKITVARCache = {}; (function($) { $.extend({ product_variationInit : function(param) { var defvals = { 'id': '_itmspec', 'class' : { 'listopt' : 'listopt', 'listitm' : 'listitm', 'radio' : 'radio', 'lnk' : 'lnk', 'opt' : 'opt', 'selected' : 'selected', 'val' : 'val', 'optpl' : 'optpl' }, 'inp' : { 'sku' : 'sku' }, 'select_template' : { 'header' : '<select class="##sel_class##" ref="##specific_id##">', 'body' : '<option value="##value_id##" ##IF:select## selected ##END IF:select##>##value_name####IF:nostock## (Out of Stock)##END IF:nostock##</option>', 'footer' : '</select>' }, 'text_template' : '', 'radio_template' : '', 'image_template' : '', 'text_class':'specific-text', 'radio_class':'specific-radio', 'image_class':'specific-image', 'loadtmplates' : [], 'show_nostock': false, 'debug': false, 'fns' : {}, 'showparam': false }; param = $.soap_default_data(param ,defvals); param['opts'] = null; nITMVARCache = param; $('.'+param['id']+'_'+param['class']['lnk']).on('click', function() { var ref = $(this).attr('ref'); var tmp = ref.split('_',2); while(tmp.length < 2) { tmp.push(''); } $.productVariationSelected(tmp[0], tmp[1]); }); $('.'+param['id']+'_'+param['class']['opt']).on('change', function() { var ref = $(this).attr('ref'); var tmp = [ref, $(this).val()]; $.productVariationSelected(tmp[0], tmp[1]); }); $('.'+param['id']+'_'+param['class']['radio']).on('click', function() { var ref = $(this).attr('ref'); var tmp = ref.split('_',2); while(tmp.length < 2) { tmp.push(''); } $.productVariationSelected(tmp[0], tmp[1]); }); }, productVariationSelected : function (spid, valid) { var param = $.getITMVARCache(); var psku = $('#'+param['id']+'_'+param['inp']['sku']).val(); var variations = {}; var changed = false; $('.'+param['id']+'_'+param['class']['val']).each(function() { var ref = $(this).attr('ref'); if(ref == spid) { var val = $(this).val(); $(this).val(valid); variations[ref] = valid; if(val != valid) { changed = true; } } else { variations[ref] = $(this).val(); } }); if(changed) { if(typeof(param['fns']['onLoad']) == 'function') { param['fns']['onLoad'](); } var ldopts = (param['opts']==null? 'y':'n'); var fn = "variations"; $.do_ajax( fn, {'proc':'change_variation','specid':spid, 'sku':psku, 'loadselector':ldopts,'variations':variations, 'show_nostock':(param['show_nostock']? 'y':'n')}, true, { 'SUCCESS': { 'def' : { 'msg':'', 'sku':'', 'showall':'n', 'variations':{}, 'selectors':{}, 'selected':{}, 'ldselectors':'n' }, 'fn' : function (code, data) { var param = $.getITMVARCache(); if(param['opts']==null) { param['opts'] = {}; } if(data['ldselectors'] == 'y') { if(data['selectors'] && data['selectors'] instanceof Object) { param['opts'] = data['selectors']; } } var allopts = $('.'+param['id']+'_'+param['class']['listopt']); allopts.each(function() { var nref = $(this).attr('ref'); if(data['showall'] == 'y' || data['variations'][nref]) { $(this).show(); } else { $('.'+param['id']+'_'+param['class']['radio']+'[ref^="'+nref+'_"]').removeAttr('checked'); $('.'+param['id']+'_'+param['class']['val']+'[ref="'+nref+'"]').val(''); $('.'+param['id']+'_'+param['class']['opt']+'[ref="'+nref+'"]').val(''); $(this).hide(); } }); var allitms = $('.'+param['id']+'_'+param['class']['listitm']); allitms.each(function() { var nref = $(this).attr('ref'); var ntmp = nref.split('_',2); while(ntmp.length < 2) { ntmp.push(''); } var lnkobj = $('.'+param['id']+'_'+param['class']['lnk']+'[ref="'+ntmp[0]+'_'+ntmp[1]+'"]'); var radioobj = $('.'+param['id']+'_'+param['class']['radio']+'[ref="'+ntmp[0]+'_'+ntmp[1]+'"]'); var valo = $('.'+param['id']+'_'+param['class']['val']+'[ref="'+ntmp[0]+'"]'); var optoby = $('.'+param['id']+'_'+param['class']['opt']+'[ref="'+ntmp[0]+'"]'); if(data['showall'] == 'y' || (data['variations'][ntmp[0]] && data['variations'][ntmp[0]][ntmp[1]])) { if(param['opts'][ntmp[0]] && param['opts'][ntmp[0]] instanceof Array && lnkobj.length>0) { var hastmpl = false; var tmpltxt = ''; if(lnkobj.is('.'+$.escape_reserved(param['text_class'])) && param['text_template'].length > 0 ) { tmpltxt = param['text_template']; hastmpl = true; } else if( lnkobj.is('.'+$.escape_reserved(param['image_class'])) && param['image_template'].length > 0 ) { tmpltxt = param['image_template']; hastmpl = true; } else if( lnkobj.is('.'+$.escape_reserved(param['radio_class'])) && param['radio_template'].length > 0 ) { tmpltxt = param['radio_template']; hastmpl = true; } if( hastmpl ) { var nref = ntmp[0]; var selopt = ''; if(data['selected'][nref]) { selopt = data['selected'][nref]; } for(var i=0; i<param['opts'][nref].length; i++) { var option = param['opts'][nref][i]; if( option['value_id'] == ntmp[1]) { var tmpdata = {}; for(var k in option) { tmpdata[k] = option[k]; } tmpdata['select'] = (selopt==tmpdata['value_id']? true: false); tmpdata['variation_store_quantity'] = $.toInt(tmpdata['variation_store_quantity']); tmpdata['nostore_quantity'] = (tmpdata['variation_store_quantity']<=0 ? true: false); tmpdata['variation_qty'] = $.toInt(tmpdata['variation_qty']); tmpdata['nostock'] = (tmpdata['variation_qty']<=0 ? true: false); lnkobj.html($.parse_ntemplate(tmpltxt, tmpdata)); } } } } if(data['selected'][ntmp[0]] && data['selected'][ntmp[0]]==ntmp[1]) { valo.val(ntmp[1]); if(radioobj.length){ $.setChecked(radioobj, true); } if(lnkobj.length){ lnkobj.addClass(param['id']+'_'+param['class']['selected']); } } else { if(lnkobj.length){ lnkobj.removeClass(param['id']+'_'+param['class']['selected']); } } $(this).show(); } else { if(lnkobj.length){ lnkobj.removeClass(param['id']+'_'+param['class']['selected']); } if(radioobj.length){ radioobj.removeAttr('checked'); } if(valo.val() == ntmp[1]) { valo.val(''); if(optoby.length){ optoby.val('') }; } $(this).hide(); } }); var allsels = $('.'+param['id']+'_'+param['class']['optpl']); allsels.each(function() { var nref = $(this).attr('ref'); if(param['opts'][nref] && param['opts'][nref] instanceof Array) { var selopt = ''; if(data['selected'][nref]) { selopt = data['selected'][nref]; } var inpdata = { 'sel_class' : param['id']+'_'+param['class']['opt'], 'specific_id' : nref }; var html = $.parse_ntemplate(param['select_template']['header'], inpdata); for(var i=0; i<param['opts'][nref].length; i++) { var option = param['opts'][nref][i]; if( typeof(data['variations'][nref]) != 'undefined' && (data['showall'] == 'y' || data['variations'][nref][option['value_id']])) { var tmpdata = inpdata; for(var k in option) { tmpdata[k] = option[k]; } tmpdata['select'] = (selopt==tmpdata['value_id']? true: false); tmpdata['variation_store_quantity'] = $.toInt(tmpdata['variation_store_quantity']); tmpdata['nostore_quantity'] = (tmpdata['variation_store_quantity']<=0 ? true: false); tmpdata['variation_qty'] = $.toInt(tmpdata['variation_qty']); tmpdata['nostock'] = (tmpdata['variation_qty']<=0 ? true: false); html += $.parse_ntemplate(param['select_template']['body'], tmpdata); } } html += $.parse_ntemplate(param['select_template']['footer'], inpdata); $(this).html(html); var real_selopt = $(this).find('.'+inpdata['sel_class']).val(); if (typeof real_selopt != 'undefined') { $('.'+param['id']+'_'+param['class']['val']+'[ref="'+nref+'"]').val(real_selopt); } } }); $(document).off("change",'.'+param['id']+'_'+param['class']['opt']); $('.'+param['id']+'_'+param['class']['opt']).on('change', function() { var ref = $(this).attr('ref'); var tmp = [ref, $(this).val()]; $.productVariationSelected(tmp[0], tmp[1]); }); if(data['sku'] != psku) { var inp = {'loaddata': 'y', 'procdata':'n', 'sku':data['sku'], 'child_templates':[]}; for(var i=1; i<param['loadtmplates'].length; i++	) { if(param['loadtmplates'][i] != '') { inp['child_templates'].push(param['loadtmplates'][i]); } } $.load_ajax_template(param['loadtmplates'][0], inp, {'onLoad':param['fns']['onReady']}); $('#'+param['id']+'_'+param['inp']['sku']).val(data['sku']); if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } else { if(typeof(param['fns']['onReady']) == 'function') { param['fns']['onReady'](); } } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if(typeof(param['fns']['onFail']) == 'function') { param['fns']['onFail'](); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {	if(param['debug']){ alert(data['response']); } } } }); } }, getITMVARCache : function ( ) { return nITMVARCache; }, kit_variationInit : function(param) { var defvals = { 'id' : 'component-var', 'class' : { 'sku' : 'sku', 'optpl' : 'optpl', 'opt' : 'opt', 'thumb' : 'thumb', 'model' : 'model' }, 'select_template' : { 'body' : '<option value="##value_id##" ##IF:select## selected ##END IF:select##>##value_name####IF:nostock## (Out of Stock)##END IF:nostock##</option>' }, 'debug': false, 'fns' : {}, 'showparam': false }; param = $.soap_default_data(param ,defvals); param['opts'] = null; nKITVARCache = param; $('.'+param['id']+'-'+param['class']['sku']).each(function () { var psku = $(this).attr('component-sku'); if(typeof(psku) != 'string' || psku.length<=0) { $(this).attr('disabled', 'disabled'); } }); $('.'+param['id']+'-'+param['class']['opt']).each(function () { if($(this).find('OPTION').length <= 0) { $(this).closest('.'+param['id']+'-'+param['class']['optpl']).hide(); } $(this).on('change', function() { $.kitVariationSelected($(this).attr('component-id'), $(this).attr('ref')); }); }); }, kitVariationSelected : function(compid, csid) { var param = $.getKITVARCache(); var pskuo = $('.'+param['id']+'-'+param['class']['sku']+'[component-id="'+$.escape_reserved(compid)+'"]'); var psku = pskuo.attr('component-sku'); var variations = {}; $('.'+param['id']+'-'+param['class']['opt']+'[component-id="'+$.escape_reserved(compid)+'"]').each(function() { var ref = $(this).attr('ref'); var val = $(this).val(); if( typeof(val) == 'undefined' ){val= '';} variations[ref] = val; }); if(typeof(param['fns']['onLoad']) == 'function') { param['fns']['onLoad'](); } var fn = "variations"; $.do_ajax( fn, {'proc':'kit_variation', 'sku':psku, 'specid':csid, 'variations':variations, 'component_id':compid, 'show_nostock':(param['show_nostock']? 'y':'n')}, true, { 'SUCCESS': { 'def' : { 'component_id':'', 'sku':'', 'variations':{}, 'item':{} }, 'fn' : function (code, data) { var param = $.getKITVARCache(); var pskuo = $('.'+param['id']+'-'+param['class']['sku']+'[component-id="'+$.escape_reserved(data['component_id'])+'"]'); for(var sid in data['variations']) { var unrestricted = data['restrictions'][sid]; var hasval = false; var selo = $('.'+param['id']+'-'+param['class']['opt']+'[component-id="'+$.escape_reserved(compid)+'"][ref="'+$.escape_reserved(sid)+'"]'); var html = ''; if(typeof(data['variations'][sid]) != 'undefined' && data['variations'][sid] instanceof Array) { for(var i=0; i< data['variations'][sid].length; i++) { var idata = data['variations'][sid][i]; if( unrestricted instanceof Object && unrestricted[idata['value_id']] ) { if(typeof(idata) != 'undefined' && idata instanceof Object) { var tmpdata = {}; for(var k in idata) { tmpdata[k] = idata[k]; } if( idata['selected'] ) { hasval=true; } tmpdata['select'] = (idata['selected']? true: false); tmpdata['variation_store_quantity'] = $.toInt(tmpdata['variation_store_quantity']); tmpdata['nostore_quantity'] = (tmpdata['variation_store_quantity']<=0 ? true: false); tmpdata['variation_qty'] = $.toInt(tmpdata['variation_qty']); tmpdata['nostock'] = (tmpdata['variation_qty']<=0 ? true: false); html += $.parse_ntemplate(param['select_template']['body'], tmpdata); } } } } if(!hasval) { html = '<option value="" selected></option>'+html; } selo.empty().append(html); } if(data['sku'].length <= 0) { pskuo.attr('disabled', 'disabled'); } else { pskuo.removeAttr('disabled'); } if(data['sku'] != pskuo.attr('component-sku')) { if(data['item']['name']) { $('.'+param['id']+'-'+param['class']['model']+'[component-id="'+$.escape_reserved(compid)+'"]').html(data['item']['name']); } if(data['item']['thumb']) { $('.'+param['id']+'-'+param['class']['thumb']+'[component-id="'+$.escape_reserved(compid)+'"]').attr('src', data['item']['thumb']); } pskuo.attr('ref', data['sku']); if(typeof(param['fns']['onChange']) == 'function') { param['fns']['onChange'](); } } if(typeof(param['fns']['onReady']) == 'function') { param['fns']['onReady'](); } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { if(typeof(param['fns']['onFail']) == 'function') { param['fns']['onFail'](); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {	if(param['debug']){ alert(data['response']); } } } }); }, getKITVARCache : function ( ) { return nKITVARCache; } }); })(jQuery); /* END PRODUCT VARIATIONS */
/** INCLUDE jquery.neto.wishlist.js **/ /* WISHLIST FUNCTIONS */ var NWishListData = new Object(); (function($) { $.extend({ addToWishList: function(param) { var defvals = { 'class': 'wishlist_toggle', 'imageon': '/assets/wishlist/remove.gif', 'imageoff': '/assets/wishlist/add.gif', 'textclass': 'wishlist_text', 'htmlon': 'Remove From Wishlist', 'htmloff': 'Add To Wishlist', 'tooltip_css': 'whltooltips', 'fade' : true, 'addmethod': 'checkbox', 'showsummary': 0, 'notifications' : { 'duration' : 2000, 'sticky' : false, 'show_close' : false, 'show_overlay' : false, 'centre_on_scroll' : true, 'hide_on_click' : false }, 'chooser' : { 'header' : '<div class="wishlistoverlay"><div class="header modal-header">Add or Remove ##model## From Wishlist</div>'+ '<table border="0" cellpadding="4" cellspacing="0" width="100%" class="body modal-body">', 'body' : '<tr><td class="listname" width="1%" nowrap="nowrap">##name##</td><td><span class="addremovelink">##button##</span></td></tr>', 'footer' : '</table>'+ '<div class="createnewlist"><a href="javascript:void(0);" onclick="$.toggleAddNew()">Or Add To A New List</a></div>'+ '<div id="wishlisttoggle" style="display:none;">'+ '<table border="0" cellpadding="4" cellspacing="0"><tr>'+ '<td>New List Name : <input type="text" maxlength="50" size="20" id="addwl##sku##" /></td>'+ '</tr></table>'+ '</div>'+ '<hr><button id="closepopup" class="btn btn-success" onclick="$.closePopup(\'##sku##\', \'addwl##sku##\')"><span id="savemsg">Save My Wishlist Changes</span></button></div>' }, 'summary' : { 'header' : '<div class="wishlistoverlay"><div class="header header-modal">Wishlist Summary</div><table border="0" cellpadding="4" cellspacing="0" width="100%" class="body">', 'body' : '<tr><td><b>##model##</b> is in wishlist <b>##name##</b></td></tr>', 'isempty' : '<tr><td>Item is removed from all wishlists</td></tr>', 'footer' : '</table><hr><button id="closepopup" class="btn btn-success" onclick="$.nClosePopupBox()">Close Window</button></div>' }, 'overlay_id' : 'whloverlay', 'button_id' : 'whlbutton', 'input_id' : 'whlinput', 'selector_id' : 'whlselector', 'msg' : { 'ITEM_ADDED': 'Added to Wishlist \'##name##\'.', 'ITEM_REMOVED': 'Removed from Wishlist \'##name##\'.', 'INVALID_SKU': 'Invalid item.', 'REQUIRE_LOGIN': 'You must first <a href="/_myacct/" title="login"><b>login</b></a> or <a href="/_myacct/" title="create an account"><b>create an account</b></a> to add to a Wishlist', 'ADDWISHLIST': 'Add New Wishlist And Save My Changes', 'SAVECHANGES': 'Save My Wishlist Changes' }, 'debug': false, 'showparam': false }; param = $.soap_default_data(param ,defvals); if(param['showparam']) { alert($.js_var_dump(param)); } NWishListData['param'] = param; var fn = 'wishlist'; var whlobj = $('.' + param['class']); $.preload_images([param['imageon'], param['imageoff']]); var curobj; var textobj; $('body').append('<div id="'+param['overlay_id']+'" class="'+param['overlay_class']+'"/>'); $('body').append('<div id="'+param['overlay_id']+'tig" style="display:none;"/>'); var overlaytig = $('#'+param['overlay_id']+'tig'); /** Local Call Function **/ var failFn = function (code, data) { if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); $.nPopupBox(msg, {'duration': 8000}); } }; var listFn = function (code, data) { var tmpl = param['chooser']; var txcols = ['button_id', 'input_id', 'overlay_id']; for(var i=0; i<txcols.length; i++) { data[txcols[i]] = param[txcols[i]]; } var html = $.parse_ntemplate(tmpl['header'], data); for(var ctr=0; ctr<data['items'].length; ctr++) { var idata = {}; for (var k in data['items'][ctr]) { idata[k] = $.htmlEncode(data['items'][ctr][k]); } if (param['addmethod'] == 'checkbox') { idata['button'] = '<input type="checkbox"'+(idata['active']=='y'? 'checked ': '')+'id="'+param['overlay_id']+'.'+param['selector_id']+ctr+'"'+' rel="'+idata['id']+'" />'; } else { idata['button'] = '<img id="'+param['overlay_id']+'.'+param['selector_id']+ctr+'" '+ 'src="'+(idata['active']=='y'? param['imageon']: param['imageoff'])+'" '+ 'rel="'+idata['id']+'"/>'; } html += $.parse_ntemplate(tmpl['body'], idata); } html += $.parse_ntemplate(tmpl['footer'], data); $.nPopupBox(html); if (param['addmethod'] == 'checkbox') { var objs = $('input[id^="'+param['overlay_id']+'.'+param['selector_id']+'"]'); $(document).off("click",objs.selector); $(document).on("click",objs.selector,function(){ var imgobj = $(this); var cwid = imgobj.attr("rel"); if ($.isChecked(imgobj)) { $.do_ajax( fn, { 'proc':'AddItem', 'sku':data['sku'], 'wishlist':cwid }, true, { 'SUCCESS': { 'def' : { 'count': 0 }, 'fn' : function (code, data) { imgobj.attr("src", param['imageon']); } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } }); } else { $.do_ajax( fn, { 'proc':'RemoveItem', 'sku':data['sku'], 'wishlist':cwid }, true, { 'SUCCESS': { 'def' : { 'count': 0 }, 'fn' : function (code, data) { imgobj.attr("src", param['imageoff']); } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } }); } }); } else { var objs = $('img[id^="'+param['overlay_id']+'.'+param['selector_id']+'"]'); $(document).off("click",objs.selector); $(document).on("click",objs.selector,function(){ var imgobj = $(this); var csrc = imgobj.attr("src"); var cwid = imgobj.attr("rel"); var sku = data['sku']; if (csrc == param['imageon']) { $.do_ajax( fn, { 'proc':'RemoveItem', 'sku':data['sku'], 'wishlist':cwid }, true, { 'SUCCESS': { 'def' : { 'count': 0 }, 'fn' : function (code, data) { imgobj.attr("src", param['imageoff']); } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } } ); } else { $.do_ajax( fn, { 'proc':'AddItem', 'sku':data['sku'], 'wishlist':cwid }, true, { 'SUCCESS': { 'def' : { 'count': 0 }, 'fn' : function (code, data) { imgobj.attr("src", param['imageon']); } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } }); } }); } }; /** End Local Call Function **/ $(document).on("click",whlobj.selector,function(){ curobj = $(this); var sku = curobj.attr("rel"); textobj =  $('[rel="'+param['textclass']+sku+'"]'); var chktest = textobj.html(); var imgobj = this; if (chktest == param['htmlon']) { $.do_ajax( fn, {'proc':'RemoveItem','sku':sku}, true, { 'SUCCESS': { 'def' : { 'name': '', 'msg':'' }, 'fn' : function (code, data) { if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); $.nPopupBox(msg, {'duration': 2000}); } textobj.replaceWith('<span rel="'+param['textclass']+sku+'">'+param['htmloff']+'</span>'); } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : failFn }, 'LIST': { 'def' : { 'brand':'', 'sku':'', 'model':'', 'items': [] }, 'fn' : listFn }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } } ); } else { $.do_ajax( fn, {'proc':'AddItem','sku':sku}, true, { 'SUCCESS': { 'def' : { 'name': '', 'msg':'' }, 'fn' : function (code, data) { if( param['msg'][data['msg']] ) { var msg = $.parse_ntemplate(param['msg'][data['msg']], data); $.nPopupBox(msg, {'duration': 2000}); } textobj.replaceWith('<span rel="'+param['textclass']+sku+'">'+param['htmlon']+'</span>'); } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : failFn }, 'LIST': { 'def' : { 'brand':'', 'sku':'', 'model':'', 'items': [] }, 'fn' : listFn }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } } ); } }); }, toggleAddNew: function() { var param = NWishListData['param']; $('#wishlisttoggle').toggle('fast', function(){ if ($('#wishlisttoggle').is(":visible")) { $('#savemsg').html(param['msg']['ADDWISHLIST']); } else { $('#savemsg').html(param['msg']['SAVECHANGES']); } }); }, closePopup: function(sku, newwishlist) { var wname = $('#'+newwishlist).val(); var fn = 'wishlist'; if (!$.is_empty(wname)) { $.do_ajax( fn, { 'proc':'AddItem', 'sku':sku, 'name':wname, 'wishlist': -1 }, true, { 'SUCCESS': { 'def' : { }, 'fn' : function (code, data) { $.btnLdFn(sku); } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } }); } else { $.btnLdFn(sku); } $.nClosePopupBox(); }, btnLdFn: function (sku) { var param = NWishListData['param']; var textobj =  $('[rel="'+param['textclass']+sku+'"]'); var fn = 'wishlist'; $.do_ajax( fn, { 'proc':'GetSKUCount', 'sku':sku }, true, { 'SUCCESS': { 'def' : { 'count': 0 }, 'fn' : function (code, data) { if (param['showsummary']) { var tmpl = param['summary']; var html = $.parse_ntemplate(tmpl['header'], data); if (data['items'].length > 0) { for(var ctr=0; ctr<data['items'].length; ctr++) { var idata = data['items'][ctr]; html += $.parse_ntemplate(tmpl['body'], idata); } } else { html += $.parse_ntemplate(tmpl['isempty'], idata); } html += $.parse_ntemplate(tmpl['footer'], data); $.nPopupBox(html); } if(data['count']>0) { textobj.replaceWith('<span rel="'+param['textclass']+sku+'">'+param['htmlon']+'</span>'); } else { textobj.replaceWith('<span rel="'+param['textclass']+sku+'">'+param['htmloff']+'</span>'); } } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) {  if(param['debug']){ alert(data['response']); } } } }); } }); }) (jQuery); /* END WISHLIST FUNCTIONS*/
/** INCLUDE jquery.neto.onready.js **/ /* ONREADY */ (function( NETO, $, undefined ) { $(function() { var fn = 'ajax_loader'; var param = {'ajax_templates' : {} }; var objs = $('span[nloader-content-id]').each(function() { var cid = $.toText($(this).attr('nloader-content-id')); param['ajax_templates'][cid] = [$.toText($(this).attr('nloader-content')),$.toText($(this).attr('nloader-data'))]; }); if(objs.length > 0) { $.do_ajax( fn, param, true, { 'SUCCESS': { 'def' : { 'rtn_contents':{} }, 'fn' : function (code, data) { $('span[nloader-content-id]').each(function() { var cid = $.toText($(this).attr('nloader-content-id')); $(this).after(data['rtn_contents'][cid]).remove(); }); if(typeof NETO.AJAX_LOADER_SUCCESSFN == 'function') { NETO.AJAX_LOADER_SUCCESSFN(); } else { (function(e){ e.style.display='table'; e.offsetHeight; e.style.display=''; }(document.documentElement)); } } }, 'FAIL': { 'def' : { 'msg': '' }, 'fn' : function (code, data) { } }, 'ERROR' : { 'def' : { 'response': '' }, 'fn' : function (code, data) { } } } ); } $.setCurrencySymbol(NETO.systemConfigs['currency_symbol']); }); }( window.NETO = window.NETO || {}, jQuery ));